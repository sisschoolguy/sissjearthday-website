<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Earth Day</title>

  <!-- Original fonts plus pixelated font for game text -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- p5.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

  <style>
    /* General Styles */
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    body {
      font-family: 'Montserrat', sans-serif;
      line-height: 1.6; 
      color: #333;
      font-size: 18px;
    }
    h1, h2, h3 {
      font-weight: 700;
    }

    /* Full-screen Pop-up - Fixed centering */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100vh;
      background-color: #c8e6c9;
      display: flex; 
      justify-content: center; 
      align-items: center;
      transition: all 0.5s ease; 
      z-index: 1000;
      background-image: url('https://sissjearthday.tiiny.site/image_2025-04-11_191011304.png');
      background-size: 60%;
      background-position: center;
      background-repeat: no-repeat;
    }
    .popup-content { 
      text-align: center; 
      max-width: 90%;
      width: 100%;
      padding: 20px;
      background-color: transparent;
    }
    .popup h1 {
      font-size: 2.5rem; 
      margin-bottom: 1rem; 
      color: #333;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    .popup p {
      font-size: 1.2rem; 
      margin-bottom: 2rem; 
      color: #333;
    }
    .popup .buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .popup .buttons button {
      background: none; 
      border: none; 
      font-size: 1.2rem; 
      cursor: pointer; 
      color: #333; 
      transition: all 0.3s ease; 
      padding: 10px 20px;
      margin: 0;
      position: relative;
    }
    .popup .buttons button:hover { 
      opacity: 0.7; 
      transform: translateY(-2px);
    }
    .arrow-down, .arrow-up {
      font-size: 2rem; 
      cursor: pointer; 
      position: absolute; 
      bottom: 20px; 
      left: 50%; 
      transform: translateX(-50%); 
      color: #333;
      transition: all 0.3s ease;
    }
    .arrow-down:hover, .arrow-up:hover {
      transform: translateX(-50%) scale(1.1);
    }

    /* Minimized Top Navigation Bar - Compact with adjusted arrow */
    .navbar {
      position: fixed; 
      top: -100px; 
      left: 0; 
      width: 100%;
      background-color: #c8e6c9; 
      display: flex; 
      align-items: center;
      padding: 0.5rem 1rem;
      transition: top 0.5s ease; 
      z-index: 999;
      height: 50px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .navbar .buttons {
      display: flex; 
      gap: 1rem;
      margin-right: auto;
    }
    .navbar .buttons button {
      background: none;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      color: #333;
      transition: all 0.3s ease;
      padding: 5px 10px;
      position: relative;
    }
    .navbar .buttons button:hover {
      opacity: 0.7;
    }
    .navbar .buttons button::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background-color: #2e7d32;
      transition: width 0.3s ease;
    }
    .navbar .buttons button:hover::after {
      width: 100%;
    }
    .navbar h1 {
      font-size: 1.2rem;
      margin-left: auto;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 50%;
      display: flex;
      align-items: center;
    }
    .navbar h1::before {
      content: '';
      display: inline-block;
      width: 30px;
      height: 30px;
      background-image: url('https://sissjearthday.tiiny.site/image_2025-04-11_191011304.png');
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 10px;
    }
    .arrow-up {
      font-size: 1.5rem;
      cursor: pointer; 
      margin-right: 1rem;
      position: relative;
      top: 0;
    }

    /* Page Sections */
    .section {
      padding: 5rem 1rem 2rem;
      min-height: 100vh; 
      display: flex;
      flex-direction: column; 
      align-items: center;
    }

    /* Information Section */
    #information { 
      background-color: #f5f5f5; 
    }
    .info-content {
      width: 100%;
      font-size: 1.1rem;
    }
    .info-content img {
      float: right;
      margin: 0 0 20px 20px;
      max-width: 100%;
      width: 350px;
      height: auto;
      object-fit: contain;
    }
    .info-content p {
      margin-bottom: 1.5rem;
      text-align: justify;
      font-size: 1.1rem;
      line-height: 1.8;
    }

    /* Game Section */
    #games { 
      background-color: #e0e0e0; 
    }
    #games h2 { 
      margin-bottom: 20px; 
    }
    .games-container {
      display: flex; 
      flex-direction: column;
      gap: 20px;
      justify-content: flex-start;
      margin-top: 20px;
      align-items: center;
      width: 100%;
    }
    .game-wrapper {
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      gap: 10px;
      width: 100%;
    }

    /* Earth Defender Container - Adjusted scaling */
    #gameContainer2 {
      position: relative; 
      overflow: hidden; 
      border: 2px solid #333; 
      background-color: #000;
      width: 100%;
      max-width: 500px;
      height: 400px;
    }

    /* Fullscreen Game Popup */
    .fullscreen-game {
      position: fixed; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      display: flex; 
      justify-content: center; 
      align-items: center;
      z-index: 2000; 
      display: none;
    }
    .fullscreen-game-content {
      position: relative;
      display: flex; 
      justify-content: center; 
      align-items: center;
      width: 100%;
      height: 100%;
    }
    .close-fullscreen {
      position: absolute; 
      top: 20px; 
      right: 20px; 
      color: white; 
      font-size: 30px;
      cursor: pointer; 
      z-index: 2001;
    }

    /* Fullscreen Button */
    .fullscreen-btn {
      background-color: #2e7d32; 
      color: white; 
      border: none; 
      padding: 10px 20px;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 16px; 
      transition: background-color 0.3s;
      width: auto;
    }
    .fullscreen-btn:hover { 
      background-color: #1b5e20; 
    }

    /* Game Instructions Popup */
    .game-instructions {
      position: absolute; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%;
      background-color: rgba(200, 230, 201, 0.95);
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center;
      text-align: center; 
      padding: 20px; 
      box-sizing: border-box; 
      z-index: 10;
    }
    .game-instructions h2 { 
      margin-bottom: 1rem; 
      color: #2e7d32; 
      font-size: 1.5rem; 
    }
    .game-instructions p { 
      margin-bottom: 1rem; 
      line-height: 1.6; 
      font-size: 1rem; 
    }
    .start-game-btn {
      background-color: #2e7d32; 
      color: white; 
      border: none; 
      padding: 10px 25px;
      font-size: 1rem; 
      border-radius: 5px; 
      cursor: pointer; 
      margin-top: 1rem;
      transition: background-color 0.3s;
    }
    .start-game-btn:hover { 
      background-color: #1b5e20; 
    }

    /* Earth Defender Game Styles */
    #earthDefenderHealthBar {
      position: absolute; 
      top: 10px; 
      right: 10px;
      width: 150px; 
      height: 20px;
      background-color: #333; 
      border-radius: 10px;
      overflow: hidden; 
      z-index: 5;
    }
    #earthDefenderHealthFill {
      height: 100%; 
      width: 100%;
      background-color: #2ecc71; 
      transition: width 0.3s;
    }

    /* Pixelated style for health and ammo text */
    #earthDefenderHealthText,
    #earthDefenderAmmoDisplay {
      position: absolute;
      color: white;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      z-index: 5;
    }
    #earthDefenderHealthText {
      top: 12px; 
      right: 170px;
    }
    #earthDefenderAmmoDisplay {
      top: 10px; 
      left: 10px;
    }
    #earthDefenderGameOver {
      position: absolute; 
      top: 50%; 
      left: 50%;
      transform: translate(-50%, -50%);
      color: white; 
      font-size: 24px; 
      text-align: center;
      display: none; 
      z-index: 10;
    }
    #earthDefenderRestartBtn {
      margin-top: 15px; 
      padding: 8px 16px; 
      font-size: 16px;
      background-color: #2ecc71; 
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
    }
    #earthDefenderRulesPopup {
      position: absolute; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center;
      text-align: center; 
      padding: 20px; 
      box-sizing: border-box;
      z-index: 15;
    }
    #earthDefenderStartBtn {
      margin-top: 15px; 
      padding: 8px 24px; 
      font-size: 16px;
      background-color: #2ecc71; 
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
    }

    /* Rules text on the right side of the game, center-aligned */
    .game-rules {
      max-width: 100%;
      width: 500px;
      line-height: 1.6;
      font-family: 'Montserrat', sans-serif;
      font-size: 16px;
      color: #000;
      background: none;
      border: none;
      padding: 0 20px;
    }
    
    /* Footer styling */
    footer {
      width: 100%;
      text-align: center;
      font-size: 12px;
      color: #333;
      padding: 15px 0;
      margin-top: 20px;
    }

    /* Mobile-specific styles */
    @media (max-width: 768px) {
      body {
        font-size: 16px;
      }
      
      .popup {
        background-size: 80%;
      }
      
      .popup h1 {
        font-size: 2rem;
      }
      
      .popup p {
        font-size: 1rem;
      }
      
      .popup .buttons button {
        font-size: 1rem;
        padding: 8px 16px;
      }
      
      .info-content img {
        float: none;
        display: block;
        margin: 0 auto 20px;
        width: 100%;
        max-width: 300px;
      }
      
      .info-content p {
        font-size: 1rem;
      }
      
      #earthDefenderHealthText {
        right: 10px;
        top: 35px;
      }
      
      #earthDefenderAmmoDisplay {
        font-size: 8px;
      }
      
      #earthDefenderHealthBar {
        width: 100px;
      }
      
      /* Adjusted game scaling */
      #gameContainer2 {
        transform: scale(1.05);
        transform-origin: top center;
        margin: 15px 0;
      }
      
      .games-container {
        gap: 10px;
      }
      
      .navbar {
        height: 45px;
      }
      
      .navbar h1 {
        font-size: 1rem;
      }
      
      .navbar h1::before {
        width: 25px;
        height: 25px;
      }
    }

    @media (max-width: 480px) {
      .popup {
        background-size: 90%;
      }
      
      .popup h1 {
        font-size: 1.8rem;
      }
      
      .popup .buttons {
        flex-direction: column;
        gap: 10px;
      }
      
      .popup .buttons button {
        width: 100%;
      }
      
      .section {
        padding: 4rem 1rem 2rem;
      }
      
      #earthDefenderRulesPopup h2 {
        font-size: 1.2rem;
      }
      
      #earthDefenderRulesPopup p {
        font-size: 0.9rem;
      }
      
      /* Adjusted game scaling */
      #gameContainer2 {
        transform: scale(1.1);
        height: 350px;
      }
      
      /* Compact navbar adjustments */
      .navbar {
        height: 40px;
      }
      
      .navbar .buttons button {
        font-size: 0.9rem;
        padding: 4px 8px;
      }
      
      .navbar h1 {
        font-size: 0.9rem;
      }
      
      .arrow-up {
        top: 0;
      }
      
      .navbar h1::before {
        width: 20px;
        height: 20px;
        margin-right: 5px;
      }
    }
  </style>
</head>
<body>
  <!-- Full-screen pop-up -->
  <div id="popup" class="popup">
    <div class="popup-content">
      <h1>Earth Day</h1>
      <p>made by SIS South Jakarta</p>
      <div class="buttons">
        <button id="infoBtn">Information</button>
        <button id="gamesBtn">Game</button>
      </div>
      <div id="closePopup" class="arrow-down">&#9660;</div>
    </div>
  </div>

  <!-- Fullscreen Game Popup -->
  <div id="fullscreenGame" class="fullscreen-game">
    <div class="fullscreen-game-content" id="fullscreenGameContent"></div>
    <div class="close-fullscreen" id="closeFullscreen">×</div>
  </div>

  <!-- Minimized top navigation bar -->
  <nav id="navbar" class="navbar">
    <div id="openPopup" class="arrow-up">&#9650;</div>
    <div class="buttons">
      <button id="infoNavBtn">Information</button>
      <button id="gamesNavBtn">Game</button>
    </div>
    <h1>Earth Day</h1>
  </nav>

  <!-- Information Section -->
  <section id="information" class="section">
    <h2>Information</h2>
    <div class="info-content">
      <img 
        src="https://sissjearthday.tiiny.site/earth_day_cleaner.png" 
        alt="Earth Day Cleaner"
      >
      <div>
        <p>
          Earth Day is celebrated on the 22nd of April every year around the globe to propagate awareness about environmental degradation and make it easier for activities to rescue our planet. Earth Day was initially celebrated in 1970 and gave rise to the current-day environmental movement. United States Senator Gaylord Nelson initiated Earth Day with a focus on bringing environmental pollution and degradation to the forefront.
        </p>
        <p>
          Earth Day is today a global movement, with more than 1 billion people getting involved every year by planting trees, picking up trash, encouraging recycling, reducing plastic consumption, and pushing for climate policy.
        </p>
        <p>
          There is a theme for every Earth Day—past themes have been climate action, bringing back ecosystems, and investing in our future. The themes are utilized to assist communities, schools, governments, and organizations in planning events and generating awareness.
        </p>
        <p>
          Earth Day is a reminder that environmental conservation is everyone's responsibility. Little things count, from switching off lights when not in use, using reusable bags, saving water, or putting money into renewable energy. It's a time to reflect on how our daily decisions affect the world—and how we can make more environmentally friendly ones.
        </p>
      </div>
    </div>
  </section>

  <!-- Game Section (Only one game remains) -->
  <section id="games" class="section">
    <h2>Game</h2>
    <div class="games-container">
      <!-- Earth Defender Game (Left side) -->
      <div class="game-wrapper">
        <h3>Earth Defender</h3>
        <div id="gameContainer2" class="game-container">
          <!-- Earth Defender Game Elements -->
          <div id="earthDefenderRulesPopup">
            <h2>EARTH DEFENDER</h2>
            <p><strong>How to Play:</strong></p>
            <p>1. Protect Earth from <span style="color:#e74c3c">red harmful words</span></p>
            <p>2. Collect <span style="color:#2ecc71">green helpful words</span> to heal</p>
            <p>3. Move mouse to aim | <strong>Click</strong> to shoot (uses 1 bullet)</p>
            <p>4. Start with 15 bullets (max 21). Get +5 from green words</p>
            <button id="earthDefenderStartBtn">START</button>
          </div>
          <div id="earthDefenderAmmoDisplay" style="display:none">
            Bullets: <span id="earthDefenderAmmoValue">15</span>/21
          </div>
          <div id="earthDefenderHealthText" style="display:none">
            Earth Health: <span id="earthDefenderHealthValue">100</span>
          </div>
          <div id="earthDefenderHealthBar" style="display:none">
            <div id="earthDefenderHealthFill"></div>
          </div>
          <div id="earthDefenderGameOver">
            GAME OVER<br>
            <button id="earthDefenderRestartBtn">Restart</button>
          </div>
          <canvas id="earthDefenderCanvas"></canvas>
        </div>
        <button class="fullscreen-btn" data-game="2">Full Screen</button>
      </div>
      <!-- Game Rules Panel (Right side, plain text) -->
      <div class="game-rules">
        This retro-inspired game challenges you to defend the planet from harmful influences. By shooting incoming threats and collecting helpful words, you actively contribute to preserving Earth's vitality. The gameplay reflects Earth Day's message by emphasizing the importance of environmental stewardship. Every shot and every saved word reminds you that even small efforts matter in protecting our world.
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    All the code developed by Mehdi Rahimli Secondary 3, and all the text by Seonghyun Je Secondary 3
  </footer>

  <script>
    // Global variables for fullscreen state and placeholders
    let currentFullscreenGame = null;
    const originalParents = {};
    const originalPlaceholders = {};

    // Smooth scrolling function
    function scrollToSection(sectionId) {
      const section = document.getElementById(sectionId);
      section.scrollIntoView({ behavior: 'smooth' });
    }

    // Popup and Navbar functionality
    const popup = document.getElementById('popup');
    const navbar = document.getElementById('navbar');
    const closePopupBtn = document.getElementById('closePopup');
    const openPopupBtn = document.getElementById('openPopup');
    const infoBtn = document.getElementById('infoBtn');
    const gamesBtn = document.getElementById('gamesBtn');
    const infoNavBtn = document.getElementById('infoNavBtn');
    const gamesNavBtn = document.getElementById('gamesNavBtn');

    closePopupBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
    });
    openPopupBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(0)';
      navbar.style.top = '-100px';
    });
    infoBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
      scrollToSection('information');
    });
    infoNavBtn.addEventListener('click', () => { scrollToSection('information'); });
    gamesBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
      scrollToSection('games');
    });
    gamesNavBtn.addEventListener('click', () => { scrollToSection('games'); });

    // Fullscreen button functionality (only Earth Defender exists, identified as game "2")
    const fullscreenButtons = document.querySelectorAll('.fullscreen-btn');
    fullscreenButtons.forEach(button => {
      button.addEventListener('click', function() {
        const gameNumber = this.getAttribute('data-game');
        if (gameNumber === '2') {
          const gameContainer = document.getElementById('gameContainer2');
          // Store original parent and insert placeholder if not done.
          if (!originalParents[gameNumber]) {
            originalParents[gameNumber] = gameContainer.parentElement;
            const placeholder = document.createElement('div');
            placeholder.style.display = 'none';
            originalParents[gameNumber].insertBefore(placeholder, gameContainer);
            originalPlaceholders[gameNumber] = placeholder;
          }
          // Save original inline styles.
          gameContainer.dataset.originalWidth = gameContainer.style.width;
          gameContainer.dataset.originalHeight = gameContainer.style.height;
          // Set container to a square and maintain aspect ratio (5:4).
          gameContainer.style.width = '90vmin';
          gameContainer.style.height = '72vmin'; // 90/1.25 = 72
          gameContainer.style.display = 'block';
          gameContainer.style.margin = 'auto';
          // Move the container to the fullscreen overlay.
          const fullscreenGame = document.getElementById('fullscreenGame');
          const fullscreenGameContent = document.getElementById('fullscreenGameContent');
          fullscreenGameContent.innerHTML = '';
          fullscreenGameContent.appendChild(gameContainer);
          fullscreenGame.style.display = 'flex';
          currentFullscreenGame = gameNumber;
          // Adjust the Earth Defender canvas.
          const edCanvas = document.getElementById('earthDefenderCanvas');
          if (edCanvas) {
            edCanvas.width = gameContainer.offsetWidth;
            edCanvas.height = gameContainer.offsetHeight;
            edCanvas.style.display = 'block';
            edCanvas.style.margin = '0 auto';
          }
          // Re-center the Earth.
          if (typeof earth !== 'undefined') {
            earth.x = edCanvas.width / 2;
            earth.y = edCanvas.height / 2;
          }
        }
      });
    });

    // Close fullscreen – return container to its original location.
    const closeFullscreen = document.getElementById('closeFullscreen');
    closeFullscreen.addEventListener('click', () => {
      if (currentFullscreenGame) {
        const gameContainer = document.getElementById('gameContainer2');
        // Restore original dimensions.
        gameContainer.style.width = gameContainer.dataset.originalWidth || '100%';
        gameContainer.style.height = gameContainer.dataset.originalHeight || '400px';
        gameContainer.style.margin = '';
        if (originalPlaceholders[currentFullscreenGame]) {
          originalPlaceholders[currentFullscreenGame].parentNode.insertBefore(gameContainer, originalPlaceholders[currentFullscreenGame]);
          originalPlaceholders[currentFullscreenGame].remove();
          delete originalPlaceholders[currentFullscreenGame];
        } else {
          originalParents[currentFullscreenGame].appendChild(gameContainer);
        }
        const fullscreenGame = document.getElementById('fullscreenGame');
        fullscreenGame.style.display = 'none';
        currentFullscreenGame = null;
      }
    });

    // =============================================
    // EARTH DEFENDER GAME CODE
    // =============================================
    document.addEventListener('DOMContentLoaded', function() {
      const canvas = document.getElementById('earthDefenderCanvas');
      const ctx = canvas.getContext('2d');
      // Disable image smoothing for a crisp pixelated look
      ctx.imageSmoothingEnabled = false;
      
      // Set initial canvas size based on container
      const container = document.getElementById('gameContainer2');
      canvas.width = container.offsetWidth;
      canvas.height = container.offsetHeight;
      
      let earthDefenderGameStarted = false;
      let earthHealth = 100;
      let earthDefenderGameRunning = true;
      let ammo = 15;
      const maxAmmo = 21;
      const harmfulWords = [
        "Plastic pollution", "Deforestation", "Air pollution", "Overfishing", "Fast fashion",
        "Fossil fuels", "Pesticide use", "Food waste", "Single-use plastics", "Water pollution",
        "Ocean acidification", "Excessive meat consumption", "Habitat destruction", "Chemical runoff",
        "Urban sprawl", "Excessive energy use", "Wildlife trafficking", "Landfills", "Mining operations",
        "Climate change denial"
      ];
      const helpfulWords = [
        "Planting trees", "Recycling", "Renewable energy", "Sustainable agriculture", "Protecting wildlife"
      ];
      let activeWords = [];
      let projectiles = [];
      let mouseX = 0;
      let mouseY = 0;
      let stars = [];

      // Load the Earth image
      const earthImg = new Image();
      earthImg.src = "https://sissjearthday.tiiny.site/earth_day_earth.png";
      // Load the arrow image
      const arrowImg = new Image();
      arrowImg.src = "https://sissjearthday.tiiny.site/earth_day_pointer.png";
      // Load the bullet image
      const bulletImg = new Image();
      bulletImg.src = "https://sissjearthday.tiiny.site/earth_day_bullet.png";

      function createStars() {
        stars = [];
        const starCount = 150;
        for (let i = 0; i < starCount; i++) {
          stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 1.5,
            opacity: Math.random()
          });
        }
      }

      // Increased space around earth by scaling down elements
      const earth = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        radius: Math.min(canvas.width, canvas.height) * 0.07, // Reduced from 0.1 to create more space
        angle: 0
      };

      const arrow = {
        x: 0,
        y: 0,
        angle: 0,
        size: Math.min(canvas.width, canvas.height) * 0.03, // Reduced size
        rotation: 0,
        orbitDistance: Math.min(canvas.width, canvas.height) * 0.12 // Reduced distance
      };

      function startGame() {
        earthDefenderGameStarted = true;
        document.getElementById('earthDefenderRulesPopup').style.display = 'none';
        document.getElementById('earthDefenderAmmoDisplay').style.display = 'block';
        document.getElementById('earthDefenderHealthText').style.display = 'block';
        document.getElementById('earthDefenderHealthBar').style.display = 'block';
        createStars();
        updateHealth();
        updateAmmo();
        earthDefenderGameLoop();
      }

      function updateArrow() {
        const angleToMouse = Math.atan2(mouseY - earth.y, mouseX - earth.x);
        arrow.x = earth.x + Math.cos(angleToMouse) * arrow.orbitDistance;
        arrow.y = earth.y + Math.sin(angleToMouse) * arrow.orbitDistance;
        arrow.rotation = angleToMouse;
      }

      function spawnWord() {
        if (activeWords.length >= 3) return; // Reduced from 5 to limit word count
        if (Math.random() > 0.07) return; // Reduced spawn rate
        const isHelpful = Math.random() < 0.2;  // 20% chance green
        const wordList = isHelpful ? helpfulWords : harmfulWords;
        const word = wordList[Math.floor(Math.random() * wordList.length)];
        const angle = Math.random() * Math.PI * 2;
        const distance = (Math.max(canvas.width, canvas.height) / 2) * 1.5; // Increased spawn distance by 1.5x
        const x = earth.x + Math.cos(angle) * distance;
        const y = earth.y + Math.sin(angle) * distance;
        const baseSpeed = 0.5; // Reduced base speed
        const speedVariation = Math.random() * 0.3 - 0.15; // Reduced variation
        const factor = (Math.random() < 0.3) ? (1.3 + Math.random() * 0.4) : 1; // Reduced factor
        const speed = Math.max(0.15, baseSpeed + speedVariation) * factor; // Reduced min speed
        const isSpinning = (Math.random() < 0.5);
        const rotationSpeed = isSpinning ? (Math.random() * 0.08 - 0.04) : 0; // Reduced rotation speed
        const rotation = isSpinning ? 0 : Math.atan2(earth.y - y, earth.x - x);
        activeWords.push({
          text: word,
          x: x,
          y: y,
          targetX: earth.x,
          targetY: earth.y,
          speed: speed,
          color: isHelpful ? '#2ecc71' : '#e74c3c',
          isHelpful: isHelpful,
          rotation: rotation,
          rotationSpeed: rotationSpeed,
          fontSize: Math.min(canvas.width, canvas.height) * 0.025 // Smaller font
        });
      }

      function createProjectile() {
        if (ammo <= 0 || !earthDefenderGameStarted) return;
        ammo--;
        updateAmmo();
        const angleToMouse = Math.atan2(mouseY - earth.y, mouseX - earth.x);
        
        // Only shoot if clicking outside earth's radius (1.5x to match new space)
        const clickDistance = Math.sqrt(Math.pow(mouseX - earth.x, 2) + Math.pow(mouseY - earth.y, 2));
        if (clickDistance <= earth.radius * 1.5) return;
        
        // Calculate position at the arrow's tip (slightly in front of arrow)
        const tipDistance = arrow.size * 0.8;
        const tipX = arrow.x + Math.cos(angleToMouse) * tipDistance;
        const tipY = arrow.y + Math.sin(angleToMouse) * tipDistance;
        
        projectiles.push({
          x: tipX,
          y: tipY,
          speed: 6 * (canvas.width / 500), // Slightly reduced speed
          angle: angleToMouse,
          size: 8 * (canvas.width / 500) // Smaller bullets
        });
      }

      function updateAmmo() {
        document.getElementById('earthDefenderAmmoValue').textContent = ammo;
      }

      function checkWordCollision(word) {
        const dx = word.x - earth.x;
        const dy = word.y - earth.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        return distance < earth.radius + 10;
      }

      function update() {
        if (!earthDefenderGameRunning || !earthDefenderGameStarted) return;
        updateArrow();
        spawnWord();
        for (let i = activeWords.length - 1; i >= 0; i--) {
          const word = activeWords[i];
          if (Math.abs(word.rotationSpeed) > 0) {
            word.rotation += word.rotationSpeed;
          } else {
            word.rotation = Math.atan2(earth.y - word.y, earth.x - word.x);
          }
          const dx = word.targetX - word.x;
          const dy = word.targetY - word.y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          word.x += (dx / distance) * word.speed;
          word.y += (dy / distance) * word.speed;
          if (checkWordCollision(word)) {
            if (word.isHelpful) {
              earthHealth = Math.min(100, earthHealth + 15);
              ammo = Math.min(maxAmmo, ammo + 5);
            } else {
              earthHealth = Math.max(0, earthHealth - 13);
            }
            updateHealth();
            updateAmmo();
            activeWords.splice(i, 1);
          }
        }
        for (let i = projectiles.length - 1; i >= 0; i--) {
          const projectile = projectiles[i];
          projectile.x += Math.cos(projectile.angle) * projectile.speed;
          projectile.y += Math.sin(projectile.angle) * projectile.speed;
          if (projectile.x < 0 || projectile.x > canvas.width || 
              projectile.y < 0 || projectile.y > canvas.height) {
            projectiles.splice(i, 1);
            continue;
          }
          for (let j = activeWords.length - 1; j >= 0; j--) {
            const word = activeWords[j];
            const dx = projectile.x - word.x;
            const dy = projectile.y - word.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < 25 * (canvas.width / 500)) { // Smaller collision distance
              activeWords.splice(j, 1);
              projectiles.splice(i, 1);
              break;
            }
          }
        }
        if (earthHealth <= 0) {
          earthDefenderGameRunning = false;
          document.getElementById('earthDefenderGameOver').style.display = 'block';
        }
      }

      function updateHealth() {
        document.getElementById('earthDefenderHealthValue').textContent = earthHealth;
        document.getElementById('earthDefenderHealthFill').style.width = `${earthHealth}%`;
        if (earthHealth < 30) {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#e74c3c';
        } else if (earthHealth < 60) {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#f39c12';
        } else {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#2ecc71';
        }
      }

      function drawStars() {
        ctx.fillStyle = '#fff';
        for (const star of stars) {
          ctx.globalAlpha = star.opacity;
          ctx.beginPath();
          ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
      }

      function draw() {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        if (earthDefenderGameStarted) drawStars();
        if (earthDefenderGameStarted) {
          // Draw the Earth using the image, keeping the same scale.
          ctx.drawImage(earthImg, earth.x - earth.radius, earth.y - earth.radius, earth.radius * 2, earth.radius * 2);
          
          // Draw the arrow (pointer) using the arrow image, flipped by 90°.
          ctx.save();
          ctx.translate(arrow.x, arrow.y);
          ctx.rotate(arrow.rotation + Math.PI/2);
          ctx.drawImage(arrowImg, -arrow.size / 2, -arrow.size / 2, arrow.size, arrow.size);
          ctx.restore();
          
          // Draw each projectile (bullet) using the bullet image.
          for (const projectile of projectiles) {
            ctx.drawImage(bulletImg, projectile.x - projectile.size, projectile.y - projectile.size, projectile.size * 2, projectile.size * 2);
          }
          
          // Use a smaller pixelated font for in-canvas text.
          const baseFontSize = Math.min(canvas.width, canvas.height) * 0.025;
          ctx.font = `${baseFontSize}px "Press Start 2P", monospace`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          for (const word of activeWords) {
            ctx.save();
            ctx.translate(word.x, word.y);
            ctx.rotate(word.rotation);
            ctx.fillStyle = word.color;
            ctx.font = `${word.fontSize}px "Press Start 2P", monospace`;
            ctx.fillText(word.text, 0, 0);
            ctx.restore();
          }
        }
      }

      function earthDefenderGameLoop() {
        update();
        draw();
        requestAnimationFrame(earthDefenderGameLoop);
      }

      // Handle window resize
      function handleResize() {
        const container = document.getElementById('gameContainer2');
        canvas.width = container.offsetWidth;
        canvas.height = container.offsetHeight;
        
        // Update game elements sizes
        earth.radius = Math.min(canvas.width, canvas.height) * 0.07;
        earth.x = canvas.width / 2;
        earth.y = canvas.height / 2;
        
        arrow.size = Math.min(canvas.width, canvas.height) * 0.03;
        arrow.orbitDistance = Math.min(canvas.width, canvas.height) * 0.12;
      }

      window.addEventListener('resize', handleResize);

      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;
      });

      canvas.addEventListener('click', () => {
        if (earthDefenderGameRunning) createProjectile();
      });

      document.getElementById('earthDefenderStartBtn').addEventListener('click', startGame);
      document.getElementById('earthDefenderRestartBtn').addEventListener('click', () => {
        earthHealth = 100;
        ammo = 15;
        activeWords = [];
        projectiles = [];
        earthDefenderGameRunning = true;
        updateHealth();
        updateAmmo();
        document.getElementById('earthDefenderGameOver').style.display = 'none';
      });
      updateHealth();
      updateAmmo();
      
      // Initialize game with proper sizing
      handleResize();
    });
  </script>
</body>
</html>
