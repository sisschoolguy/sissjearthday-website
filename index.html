<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Earth Day</title>

  <!-- Original fonts plus pixelated font for game text -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- p5.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

  <style>
    /* General Styles */
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    body {
      font-family: 'Montserrat', sans-serif;
      line-height: 1.6; 
      color: #333;
    }
    h1, h2, h3 {
      font-weight: 700;
    }

    /* Full-screen Pop-up */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100vh;
      background-color: #c8e6c9;
      display: flex; 
      justify-content: center; 
      align-items: center;
      transition: all 0.5s ease; 
      z-index: 1000;
    }
    .popup-content { 
      text-align: center; 
      max-width: 80%; 
    }
    .popup h1 {
      font-size: 4rem; 
      margin-bottom: 1rem; 
    }
    .popup p {
      font-size: 1.2rem; 
      margin-bottom: 2rem; 
    }
    .buttons button {
      background: none; 
      border: none; 
      font-size: 1.2rem; 
      margin: 0 1rem; 
      cursor: pointer; 
      color: #333; 
      transition: opacity 0.3s ease; 
    }
    .buttons button:hover { 
      opacity: 0.7; 
    }
    .arrow-down, .arrow-up {
      font-size: 2rem; 
      cursor: pointer; 
      position: absolute; 
      bottom: 20px; 
      left: 50%; 
      transform: translateX(-50%); 
    }

    /* Minimized Top Navigation Bar */
    .navbar {
      position: fixed; 
      top: -100px; 
      left: 0; 
      width: 100%;
      background-color: #c8e6c9; 
      display: flex; 
      align-items: center;
      padding: 1rem 2rem; 
      transition: top 0.5s ease; 
      z-index: 999;
    }
    .navbar .buttons {
      display: flex; 
      gap: 1rem; 
      margin-right: auto;
    }
    .navbar h1 {
      font-size: 1.5rem; 
      margin-left: auto;
    }
    .arrow-up {
      font-size: 1.5rem; 
      cursor: pointer; 
      margin-right: 1rem;
    }

    /* Page Sections */
    .section {
      padding: 6rem 2rem 2rem;
      min-height: 100vh; 
      display: flex;
      flex-direction: column; 
      align-items: center;
    }

    /* Information Section with revised image placement */
    #information { 
      background-color: #f5f5f5; 
    }
    .info-content {
      width: 100%;
      max-width: 900px;
    }
    .info-content p {
      margin-bottom: 1rem;
      text-align: justify;
    }
    /* The image is inserted after the first paragraph and floated right */
    .info-img {
      float: right;
      margin: 10px 0 10px 10px;
      max-width: 350px;
      height: auto;
      object-fit: contain;
    }

    /* Game Section (Only one game remains) */
    #games { 
      background-color: #e0e0e0; 
    }
    #games h2 { 
      margin-bottom: 20px; 
    }
    .games-container {
      display: flex; 
      gap: 80px; 
      justify-content: flex-start;
      flex-wrap: nowrap;
      margin-top: 40px;
      align-items: center;
    }
    .game-wrapper {
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      gap: 10px;
    }

    /* Earth Defender Container */
    #gameContainer2 {
      position: relative; 
      overflow: hidden; 
      border: 2px solid #333; 
      background-color: #000;
      width: 500px; 
      height: 400px;
    }

    /* Fullscreen Game Popup */
    .fullscreen-game {
      position: fixed; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      display: flex; 
      justify-content: center; 
      align-items: center;
      z-index: 2000; 
      display: none;
    }
    .fullscreen-game-content {
      position: relative;
      display: flex; 
      justify-content: center; 
      align-items: center;
    }
    .close-fullscreen {
      position: absolute; 
      top: 20px; 
      right: 20px; 
      color: white; 
      font-size: 30px;
      cursor: pointer; 
      z-index: 2001;
    }

    /* Fullscreen Button */
    .fullscreen-btn {
      background-color: #2e7d32; 
      color: white; 
      border: none; 
      padding: 8px 16px;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 14px; 
      transition: background-color 0.3s;
    }
    .fullscreen-btn:hover { 
      background-color: #1b5e20; 
    }

    /* Game Instructions Popup */
    .game-instructions {
      position: absolute; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%;
      background-color: rgba(200, 230, 201, 0.95);
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center;
      text-align: center; 
      padding: 20px; 
      box-sizing: border-box; 
      z-index: 10;
    }
    .game-instructions h2 { 
      margin-bottom: 1rem; 
      color: #2e7d32; 
      font-size: 1.5rem; 
    }
    .game-instructions p { 
      margin-bottom: 1rem; 
      line-height: 1.6; 
      font-size: 1rem; 
    }
    .start-game-btn {
      background-color: #2e7d32; 
      color: white; 
      border: none; 
      padding: 10px 25px;
      font-size: 1rem; 
      border-radius: 5px; 
      cursor: pointer; 
      margin-top: 1rem;
      transition: background-color 0.3s;
    }
    .start-game-btn:hover { 
      background-color: #1b5e20; 
    }

    /* Earth Defender Game Styles */
    #earthDefenderHealthBar {
      position: absolute; 
      top: 10px; 
      right: 10px;
      width: 150px; 
      height: 20px;
      background-color: #333; 
      border-radius: 10px;
      overflow: hidden; 
      z-index: 5;
    }
    #earthDefenderHealthFill {
      height: 100%; 
      width: 100%;
      background-color: #2ecc71; 
      transition: width 0.3s;
    }

    /* Pixelated style for health and ammo text */
    #earthDefenderHealthText,
    #earthDefenderAmmoDisplay {
      position: absolute;
      color: white;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      z-index: 5;
    }
    #earthDefenderHealthText {
      top: 12px; 
      right: 170px;
    }
    #earthDefenderAmmoDisplay {
      top: 10px; 
      left: 10px;
    }
    #earthDefenderGameOver {
      position: absolute; 
      top: 50%; 
      left: 50%;
      transform: translate(-50%, -50%);
      color: white; 
      font-size: 24px; 
      text-align: center;
      display: none; 
      z-index: 10;
    }
    #earthDefenderRestartBtn {
      margin-top: 15px; 
      padding: 8px 16px; 
      font-size: 16px;
      background-color: #2ecc71; 
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
    }
    #earthDefenderRulesPopup {
      position: absolute; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center;
      text-align: center; 
      padding: 20px; 
      box-sizing: border-box;
      z-index: 15;
    }
    #earthDefenderStartBtn {
      margin-top: 15px; 
      padding: 8px 24px; 
      font-size: 16px;
      background-color: #2ecc71; 
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
    }

    /* Rules text on the right side of the game, center-aligned */
    .game-rules {
      max-width: 300px;
      line-height: 1.6;
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
      color: #000;
      background: none;
      border: none;
      padding: 0;
    }
    
    /* Footer styling */
    footer {
      width: 100%;
      text-align: center;
      font-size: 10px;
      color: #333;
      padding: 10px 0;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- Full-screen pop-up -->
  <div id="popup" class="popup">
    <div class="popup-content">
      <h1>Earth Day</h1>
      <p>made by SIS South Jakarta</p>
      <div class="buttons">
        <button id="infoBtn">Information</button>
        <button id="gamesBtn">Game</button>
      </div>
      <div id="closePopup" class="arrow-down">&#9660;</div>
    </div>
  </div>

  <!-- Fullscreen Game Popup -->
  <div id="fullscreenGame" class="fullscreen-game">
    <div class="fullscreen-game-content" id="fullscreenGameContent"></div>
    <div class="close-fullscreen" id="closeFullscreen">Ã—</div>
  </div>

  <!-- Minimized top navigation bar -->
  <nav id="navbar" class="navbar">
    <div id="openPopup" class="arrow-up">&#9650;</div>
    <div class="buttons">
      <button id="infoNavBtn">Information</button>
      <button id="gamesNavBtn">Game</button>
    </div>
    <h1>Earth Day</h1>
  </nav>

  <!-- Information Section -->
  <section id="information" class="section">
    <h2>Information</h2>
    <div class="info-content">
      <div>
        <p>
          Earth Day is celebrated on the 22nd of April every year around the globe to propagate awareness about environmental degradation and make it easier for activities to rescue our planet. Earth Day was initially celebrated in 1970 and gave rise to the current-day environmental movement. United States Senator Gaylord Nelson initiated Earth Day with a focus on bringing environmental pollution and degradation to the forefront.
        </p>
        <img 
          src="https://sissjearthday.tiiny.site/earth_day_cleaner.png" 
          alt="Earth Day Cleaner" 
          class="info-img"
        >
        <p>
          Earth Day is today a global movement, with more than 1 billion people getting involved every year by planting trees, picking up trash, encouraging recycling, reducing plastic consumption, and pushing for climate policy.
        </p>
        <p>
          There is a theme for every Earth Dayâ€”past themes have been climate action, bringing back ecosystems, and investing in our future. The themes are utilized to assist communities, schools, governments, and organizations in planning events and generating awareness.
        </p>
        <p>
          Earth Day is a reminder that environmental conservation is everyone's responsibility. Little things count, from switching off lights when not in use, using reusable bags, saving water, or putting money into renewable energy. It's a time to reflect on how our daily decisions affect the worldâ€”and how we can make more environmentally friendly ones.
        </p>
      </div>
    </div>
  </section>

  <!-- Game Section (Only one game remains) -->
  <section id="games" class="section">
    <h2>Game</h2>
    <div class="games-container">
      <!-- Earth Defender Game (Left side) -->
      <div class="game-wrapper">
        <h3>Earth Defender</h3>
        <div id="gameContainer2" class="game-container">
          <!-- Earth Defender Game Elements -->
          <div id="earthDefenderRulesPopup">
            <h2>EARTH DEFENDER</h2>
            <p><strong>How to Play:</strong></p>
            <p>1. Protect Earth from <span style="color:#e74c3c">red harmful words</span></p>
            <p>2. Collect <span style="color:#2ecc71">green helpful words</span> to heal</p>
            <p>3. Move mouse to aim | <strong>Click</strong> to shoot (uses 1 bullet)</p>
            <p>4. Start with 15 bullets (max 21). Get +5 from green words</p>
            <button id="earthDefenderStartBtn">START</button>
          </div>
          <div id="earthDefenderAmmoDisplay" style="display:none">
            Bullets: <span id="earthDefenderAmmoValue">15</span>/21
          </div>
          <div id="earthDefenderHealthText" style="display:none">
            Earth Health: <span id="earthDefenderHealthValue">100</span>
          </div>
          <div id="earthDefenderHealthBar" style="display:none">
            <div id="earthDefenderHealthFill"></div>
          </div>
          <div id="earthDefenderGameOver">
            GAME OVER<br>
            <button id="earthDefenderRestartBtn">Restart</button>
          </div>
          <canvas id="earthDefenderCanvas"></canvas>
        </div>
        <button class="fullscreen-btn" data-game="2">Full Screen</button>
      </div>
      <!-- Game Rules Panel (Right side, plain text) -->
      <div class="game-rules">
        This retro-inspired game challenges you to defend the planet from harmful influences. By shooting incoming threats and collecting helpful words, you actively contribute to preserving Earthâ€™s vitality. The gameplay reflects Earth Dayâ€™s message by emphasizing the importance of environmental stewardship. Every shot and every saved word reminds you that even small efforts matter in protecting our world.
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    All the code developed by Mehdi Rahimli Secondary 3, and all the text by Seonghyun Je Secondary 3
  </footer>

  <script>
    // Global variables for fullscreen state and placeholders
    let currentFullscreenGame = null;
    const originalParents = {};
    const originalPlaceholders = {};

    // Smooth scrolling function
    function scrollToSection(sectionId) {
      const section = document.getElementById(sectionId);
      section.scrollIntoView({ behavior: 'smooth' });
    }

    // Popup and Navbar functionality
    const popup = document.getElementById('popup');
    const navbar = document.getElementById('navbar');
    const closePopupBtn = document.getElementById('closePopup');
    const openPopupBtn = document.getElementById('openPopup');
    const infoBtn = document.getElementById('infoBtn');
    const gamesBtn = document.getElementById('gamesBtn');
    const infoNavBtn = document.getElementById('infoNavBtn');
    const gamesNavBtn = document.getElementById('gamesNavBtn');

    closePopupBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
    });
    openPopupBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(0)';
      navbar.style.top = '-100px';
    });
    infoBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
      scrollToSection('information');
    });
    infoNavBtn.addEventListener('click', () => { scrollToSection('information'); });
    gamesBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
      scrollToSection('games');
    });
    gamesNavBtn.addEventListener('click', () => { scrollToSection('games'); });

    // Fullscreen button functionality (only Earth Defender exists, identified as game "2")
    const fullscreenButtons = document.querySelectorAll('.fullscreen-btn');
    fullscreenButtons.forEach(button => {
      button.addEventListener('click', function() {
        const gameNumber = this.getAttribute('data-game');
        if (gameNumber === '2') {
          const gameContainer = document.getElementById('gameContainer2');
          // Store original parent and insert placeholder if not done.
          if (!originalParents[gameNumber]) {
            originalParents[gameNumber] = gameContainer.parentElement;
            const placeholder = document.createElement('div');
            placeholder.style.display = 'none';
            originalParents[gameNumber].insertBefore(placeholder, gameContainer);
            originalPlaceholders[gameNumber] = placeholder;
          }
          // Save original inline styles.
          gameContainer.dataset.originalWidth = gameContainer.style.width;
          gameContainer.dataset.originalHeight = gameContainer.style.height;
          // Set container to a square and maintain aspect ratio (5:4).
          gameContainer.style.width = '90vmin';
          gameContainer.style.height = '72vmin'; // 90/1.25 = 72
          gameContainer.style.display = 'block';
          gameContainer.style.margin = 'auto';
          // Move the container to the fullscreen overlay.
          const fullscreenGame = document.getElementById('fullscreenGame');
          const fullscreenGameContent = document.getElementById('fullscreenGameContent');
          fullscreenGameContent.innerHTML = '';
          fullscreenGameContent.appendChild(gameContainer);
          fullscreenGame.style.display = 'flex';
          currentFullscreenGame = gameNumber;
          // Adjust the Earth Defender canvas.
          const edCanvas = document.getElementById('earthDefenderCanvas');
          if (edCanvas) {
            edCanvas.width = gameContainer.offsetWidth;
            edCanvas.height = gameContainer.offsetHeight;
            edCanvas.style.display = 'block';
            edCanvas.style.margin = '0 auto';
          }
          // Re-center the Earth.
          if (typeof earth !== 'undefined') {
            earth.x = edCanvas.width / 2;
            earth.y = edCanvas.height / 2;
          }
        }
      });
    });

    // Close fullscreen â€“ return container to its original location.
    const closeFullscreen = document.getElementById('closeFullscreen');
    closeFullscreen.addEventListener('click', () => {
      if (currentFullscreenGame) {
        const gameContainer = document.getElementById('gameContainer2');
        // Restore original dimensions.
        gameContainer.style.width = gameContainer.dataset.originalWidth || '500px';
        gameContainer.style.height = gameContainer.dataset.originalHeight || '400px';
        gameContainer.style.margin = '';
        if (originalPlaceholders[currentFullscreenGame]) {
          originalPlaceholders[currentFullscreenGame].parentNode.insertBefore(gameContainer, originalPlaceholders[currentFullscreenGame]);
          originalPlaceholders[currentFullscreenGame].remove();
          delete originalPlaceholders[currentFullscreenGame];
        } else {
          originalParents[currentFullscreenGame].appendChild(gameContainer);
        }
        const fullscreenGame = document.getElementById('fullscreenGame');
        fullscreenGame.style.display = 'none';
        currentFullscreenGame = null;
      }
    });

    // =============================================
    // EARTH DEFENDER GAME CODE
    // =============================================
    document.addEventListener('DOMContentLoaded', function() {
      const canvas = document.getElementById('earthDefenderCanvas');
      const ctx = canvas.getContext('2d');
      // Disable image smoothing for a crisp pixelated look
      ctx.imageSmoothingEnabled = false;
      canvas.width = 500;
      canvas.height = 400;
      let earthDefenderGameStarted = false;
      let earthHealth = 100;
      let earthDefenderGameRunning = true;
      let ammo = 15;
      const maxAmmo = 21;
      const harmfulWords = [
        "Plastic pollution", "Deforestation", "Air pollution", "Overfishing", "Fast fashion",
        "Fossil fuels", "Pesticide use", "Food waste", "Single-use plastics", "Water pollution",
        "Ocean acidification", "Excessive meat consumption", "Habitat destruction", "Chemical runoff",
        "Urban sprawl", "Excessive energy use", "Wildlife trafficking", "Landfills", "Mining operations",
        "Climate change denial"
      ];
      const helpfulWords = [
        "Planting trees", "Recycling", "Renewable energy", "Sustainable agriculture", "Protecting wildlife"
      ];
      let activeWords = [];
      let projectiles = [];
      let mouseX = 0;
      let mouseY = 0;
      let stars = [];

      // Load the Earth image
      const earthImg = new Image();
      earthImg.src = "https://sissjearthday.tiiny.site/earth_day_earth.png";
      // Load the arrow image
      const arrowImg = new Image();
      arrowImg.src = "https://sissjearthday.tiiny.site/earth_day_pointer.png";
      // Load the bullet image
      const bulletImg = new Image();
      bulletImg.src = "https://sissjearthday.tiiny.site/earth_day_bullet.png";

      function createStars() {
        stars = [];
        const starCount = 150;
        for (let i = 0; i < starCount; i++) {
          stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 1.5,
            opacity: Math.random()
          });
        }
      }

      const earth = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        radius: 50,
        angle: 0
      };

      const arrow = {
        x: 0,
        y: 0,
        angle: 0,
        size: 20,
        rotation: 0,
        orbitDistance: 80
      };

      function startGame() {
        earthDefenderGameStarted = true;
        document.getElementById('earthDefenderRulesPopup').style.display = 'none';
        document.getElementById('earthDefenderAmmoDisplay').style.display = 'block';
        document.getElementById('earthDefenderHealthText').style.display = 'block';
        document.getElementById('earthDefenderHealthBar').style.display = 'block';
        createStars();
        updateHealth();
        updateAmmo();
        earthDefenderGameLoop();
      }

      function updateArrow() {
        const angleToMouse = Math.atan2(mouseY - earth.y, mouseX - earth.x);
        arrow.x = earth.x + Math.cos(angleToMouse) * arrow.orbitDistance;
        arrow.y = earth.y + Math.sin(angleToMouse) * arrow.orbitDistance;
        arrow.rotation = angleToMouse;
      }

      // In spawnWord, green words now have a 20% chance; red words will spawn 80% of the time.
      // Also, words now spawn further away by using a multiplier of 2.
      function spawnWord() {
        if (activeWords.length >= 5) return;
        if (Math.random() > 0.05) return;
        const isHelpful = Math.random() < 0.2;  // 20% chance green
        const wordList = isHelpful ? helpfulWords : harmfulWords;
        const word = wordList[Math.floor(Math.random() * wordList.length)];
        const angle = Math.random() * Math.PI * 2;
        const distance = (Math.max(canvas.width, canvas.height) / 2) * 2;  // Spawn further out
        const x = earth.x + Math.cos(angle) * distance;
        const y = earth.y + Math.sin(angle) * distance;
        const baseSpeed = 0.8;
        const speedVariation = Math.random() * 0.4 - 0.2;
        const factor = (Math.random() < 0.3) ? (1.5 + Math.random() * 0.5) : 1;
        const speed = Math.max(0.2, baseSpeed + speedVariation) * factor;
        const isSpinning = (Math.random() < 0.5);
        const rotationSpeed = isSpinning ? (Math.random() * 0.1 - 0.05) : 0;
        const rotation = isSpinning ? 0 : Math.atan2(earth.y - y, earth.x - x);
        activeWords.push({
          text: word,
          x: x,
          y: y,
          targetX: earth.x,
          targetY: earth.y,
          speed: speed,
          color: isHelpful ? '#2ecc71' : '#e74c3c',
          isHelpful: isHelpful,
          rotation: rotation,
          rotationSpeed: rotationSpeed
        });
      }

      function createProjectile() {
        if (ammo <= 0 || !earthDefenderGameStarted) return;
        ammo--;
        updateAmmo();
        const angleToMouse = Math.atan2(mouseY - arrow.y, mouseX - arrow.x);
        projectiles.push({
          x: arrow.x,
          y: arrow.y,
          speed: 7,
          angle: angleToMouse,
          size: 10
        });
      }

      function updateAmmo() {
        document.getElementById('earthDefenderAmmoValue').textContent = ammo;
      }

      function checkWordCollision(word) {
        const dx = word.x - earth.x;
        const dy = word.y - earth.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        return distance < earth.radius + 10;
      }

      function update() {
        if (!earthDefenderGameRunning || !earthDefenderGameStarted) return;
        updateArrow();
        spawnWord();
        for (let i = activeWords.length - 1; i >= 0; i--) {
          const word = activeWords[i];
          if (Math.abs(word.rotationSpeed) > 0) {
            word.rotation += word.rotationSpeed;
          } else {
            word.rotation = Math.atan2(earth.y - word.y, earth.x - word.x);
          }
          const dx = word.targetX - word.x;
          const dy = word.targetY - word.y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          word.x += (dx / distance) * word.speed;
          word.y += (dy / distance) * word.speed;
          if (checkWordCollision(word)) {
            if (word.isHelpful) {
              earthHealth = Math.min(100, earthHealth + 15);
              ammo = Math.min(maxAmmo, ammo + 5);
            } else {
              earthHealth = Math.max(0, earthHealth - 13);
            }
            updateHealth();
            updateAmmo();
            activeWords.splice(i, 1);
          }
        }
        for (let i = projectiles.length - 1; i >= 0; i--) {
          const projectile = projectiles[i];
          projectile.x += Math.cos(projectile.angle) * projectile.speed;
          projectile.y += Math.sin(projectile.angle) * projectile.speed;
          if (projectile.x < 0 || projectile.x > canvas.width || 
              projectile.y < 0 || projectile.y > canvas.height) {
            projectiles.splice(i, 1);
            continue;
          }
          for (let j = activeWords.length - 1; j >= 0; j--) {
            const word = activeWords[j];
            const dx = projectile.x - word.x;
            const dy = projectile.y - word.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < 30) {
              activeWords.splice(j, 1);
              projectiles.splice(i, 1);
              break;
            }
          }
        }
        if (earthHealth <= 0) {
          earthDefenderGameRunning = false;
          document.getElementById('earthDefenderGameOver').style.display = 'block';
        }
      }

      function updateHealth() {
        document.getElementById('earthDefenderHealthValue').textContent = earthHealth;
        document.getElementById('earthDefenderHealthFill').style.width = ${earthHealth}%;
        if (earthHealth < 30) {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#e74c3c';
        } else if (earthHealth < 60) {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#f39c12';
        } else {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#2ecc71';
        }
      }

      function drawStars() {
        ctx.fillStyle = '#fff';
        for (const star of stars) {
          ctx.globalAlpha = star.opacity;
          ctx.beginPath();
          ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
      }

      function draw() {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        if (earthDefenderGameStarted) drawStars();
        if (earthDefenderGameStarted) {
          // Draw the Earth using the image, keeping the same scale.
          ctx.drawImage(earthImg, earth.x - earth.radius, earth.y - earth.radius, earth.radius * 2, earth.radius * 2);
          
          // Draw the arrow (pointer) using the arrow image, flipped by 90Â°.
          ctx.save();
          ctx.translate(arrow.x, arrow.y);
          ctx.rotate(arrow.rotation + Math.PI/2);
          ctx.drawImage(arrowImg, -arrow.size / 2, -arrow.size / 2, arrow.size, arrow.size);
          ctx.restore();
          
          // Draw each projectile (bullet) using the bullet image.
          for (const projectile of projectiles) {
            ctx.drawImage(bulletImg, projectile.x - projectile.size, projectile.y - projectile.size, projectile.size * 2, projectile.size * 2);
          }
          
          // Use a smaller pixelated font for in-canvas text.
          ctx.font = '10px "Press Start 2P", monospace';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          for (const word of activeWords) {
            ctx.save();
            ctx.translate(word.x, word.y);
            ctx.rotate(word.rotation);
            ctx.fillStyle = word.color;
            ctx.fillText(word.text, 0, 0);
            ctx.restore();
          }
        }
      }

      function earthDefenderGameLoop() {
        update();
        draw();
        requestAnimationFrame(earthDefenderGameLoop);
      }

      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;
      });

      canvas.addEventListener('click', () => {
        if (earthDefenderGameRunning) createProjectile();
      });

      document.getElementById('earthDefenderStartBtn').addEventListener('click', startGame);
      document.getElementById('earthDefenderRestartBtn').addEventListener('click', () => {
        earthHealth = 100;
        ammo = 15;
        activeWords = [];
        projectiles = [];
        earthDefenderGameRunning = true;
        updateHealth();
        updateAmmo();
        document.getElementById('earthDefenderGameOver').style.display = 'none';
      });
      updateHealth();
      updateAmmo();
    });
  </script>
</body>
</html>
