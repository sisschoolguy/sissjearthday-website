<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Earth Day</title>

  <!-- Original fonts plus pixelated font for game text -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- p5.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

  <style>
    /* General Styles */
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    body {
      font-family: 'Montserrat', sans-serif;
      line-height: 1.6; 
      color: #333;
      font-size: 18px;
    }
    h1, h2, h3 {
      font-weight: 700;
    }

    /* Full-screen Pop-up - Fixed centering */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100vh;
      background-color: #c8e6c9;
      display: flex; 
      justify-content: center; 
      align-items: center;
      transition: all 0.5s ease; 
      z-index: 1000;
      background-image: url('https://sissjearthday.tiiny.site/image_2025-04-11_191011304.png');
      background-size: 40%; /* Reduced from 60% for desktop */
      background-position: center;
      background-repeat: no-repeat;
    }
    .popup-content { 
      text-align: center; 
      max-width: 90%;
      width: 100%;
      padding: 20px;
      background-color: transparent;
    }
    .popup h1 {
      font-size: 2.5rem; 
      margin-bottom: 1rem; 
      color: #333;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    .popup p {
      font-size: 1.2rem; 
      margin-bottom: 2rem; 
      color: #333;
    }
    .popup .buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .popup .buttons button {
      background: none; 
      border: none; 
      font-size: 1.2rem; 
      cursor: pointer; 
      color: #333; 
      transition: all 0.3s ease; 
      padding: 10px 20px;
      margin: 0;
      position: relative;
    }
    .popup .buttons button:hover { 
      opacity: 0.7; 
      transform: translateY(-2px);
    }
    .arrow-down, .arrow-up {
      font-size: 2rem; 
      cursor: pointer; 
      position: absolute; 
      bottom: 20px; 
      left: 50%; 
      transform: translateX(-50%); 
      color: #333;
      transition: all 0.3s ease;
    }
    .arrow-down:hover, .arrow-up:hover {
      transform: translateX(-50%) scale(1.1);
    }

    /* Minimized Top Navigation Bar - Compact with adjusted arrow */
    .navbar {
      position: fixed; 
      top: -100px; 
      left: 0; 
      width: 100%;
      background-color: #c8e6c9; 
      display: flex; 
      align-items: center;
      padding: 0.5rem 1rem;
      transition: top 0.5s ease; 
      z-index: 999;
      height: 50px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .navbar .buttons {
      display: flex; 
      gap: 1rem;
      margin-right: auto;
    }
    .navbar .buttons button {
      background: none;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      color: #333;
      transition: all 0.3s ease;
      padding: 5px 10px;
      position: relative;
    }
    .navbar .buttons button:hover {
      opacity: 0.7;
    }
    .navbar .buttons button::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background-color: #2e7d32;
      transition: width 0.3s ease;
    }
    .navbar .buttons button:hover::after {
      width: 100%;
    }
    .navbar h1 {
      font-size: 1.2rem;
      margin-left: auto;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 50%;
      display: flex;
      align-items: center;
    }
    .navbar h1::before {
      content: '';
      display: inline-block;
      width: 30px;
      height: 30px;
      background-image: url('https://sissjearthday.tiiny.site/image_2025-04-11_191011304.png');
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 10px;
    }
    .arrow-up {
      font-size: 1.5rem;
      cursor: pointer; 
      margin-right: 1rem;
      position: relative;
      top: 0;
    }

    /* Page Sections */
    .section {
      padding: 5rem 1rem 2rem;
      min-height: 100vh; 
      display: flex;
      flex-direction: column; 
      align-items: center;
    }

    /* Information Section */
    #information { 
      background-color: #f5f5f5; 
    }
    .info-content {
      width: 100%;
      font-size: 1.1rem;
    }
    .info-content img {
      float: right;
      margin: 0 0 20px 20px;
      max-width: 100%;
      width: 350px;
      height: auto;
      object-fit: contain;
    }
    .info-content p {
      margin-bottom: 1.5rem;
      text-align: justify;
      font-size: 1.1rem;
      line-height: 1.8;
    }

    /* Games Section */
    #games { 
      background-color: #e0e0e0; 
    }
    #games h2 { 
      margin-bottom: 20px; 
    }
    .games-container {
      display: flex; 
      flex-direction: column;
      gap: 20px;
      justify-content: flex-start;
      margin-top: 20px;
      align-items: center;
      width: 100%;
    }
    .game-wrapper {
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      gap: 10px;
      width: 100%;
    }

    /* Game Containers */
    #gameContainer2 {
      position: relative; 
      overflow: hidden; 
      border: 2px solid #333; 
      background-color: #000;
      width: 100%;
      max-width: 500px;
      height: 400px;
    }

    #squirrelGameContainer {
      position: relative;
      overflow: hidden;
      border: 2px solid #333;
      background-color: #000;
      width: 300px;
      height: 450px;
    }

    /* Fullscreen Game Popup */
    .fullscreen-game {
      position: fixed; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      display: flex; 
      justify-content: center; 
      align-items: center;
      z-index: 2000; 
      display: none;
    }
    .fullscreen-game-content {
      position: relative;
      display: flex; 
      justify-content: center; 
      align-items: center;
      width: 100%;
      height: 100%;
    }
    .close-fullscreen {
      position: absolute; 
      top: 20px; 
      right: 20px; 
      color: white; 
      font-size: 30px;
      cursor: pointer; 
      z-index: 2001;
    }

    /* Fullscreen Button */
    .fullscreen-btn {
      background-color: #2e7d32; 
      color: white; 
      border: none; 
      padding: 10px 20px;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 16px; 
      transition: background-color 0.3s;
      width: auto;
    }
    .fullscreen-btn:hover { 
      background-color: #1b5e20; 
    }

    /* Earth Defender Game Styles */
    #earthDefenderHealthBar {
      position: absolute; 
      top: 10px; 
      right: 10px;
      width: 150px; 
      height: 20px;
      background-color: #333; 
      border-radius: 10px;
      overflow: hidden; 
      z-index: 5;
    }
    #earthDefenderHealthFill {
      height: 100%; 
      width: 100%;
      background-color: #2ecc71; 
      transition: width 0.3s;
    }

    /* Pixelated style for health and ammo text */
    #earthDefenderHealthText,
    #earthDefenderAmmoDisplay {
      position: absolute;
      color: white;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      z-index: 5;
    }
    #earthDefenderHealthText {
      top: 12px; 
      right: 170px;
    }
    #earthDefenderAmmoDisplay {
      top: 10px; 
      left: 10px;
    }
    #earthDefenderGameOver {
      position: absolute; 
      top: 50%; 
      left: 50%;
      transform: translate(-50%, -50%);
      color: white; 
      font-size: 24px; 
      text-align: center;
      display: none; 
      z-index: 10;
    }
    #earthDefenderRestartBtn {
      margin-top: 15px; 
      padding: 8px 16px; 
      font-size: 16px;
      background-color: #2ecc71; 
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
    }
    #earthDefenderRulesPopup {
      position: absolute; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center;
      text-align: center; 
      padding: 20px; 
      box-sizing: border-box;
      z-index: 15;
    }
    #earthDefenderStartBtn {
      margin-top: 15px; 
      padding: 8px 24px; 
      font-size: 16px;
      background-color: #2ecc71; 
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
    }

    /* Squirrel Climber Game Styles */
    #squirrelGameInstructions {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(200, 230, 201, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
      z-index: 10;
    }
    #squirrelGameInstructions h2 {
      margin-bottom: 1rem;
      color: #2e7d32;
    }
    #squirrelGameInstructions p {
      margin-bottom: 1rem;
      line-height: 1.6;
    }
    #startSquirrelGameBtn, #restartSquirrelGameBtn {
      background-color: #2e7d32;
      color: white;
      border: none;
      padding: 10px 25px;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }
    #startSquirrelGameBtn:hover, #restartSquirrelGameBtn:hover {
      background-color: #1b5e20;
    }
    #squirrelDeathScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(139, 0, 0, 0.9);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
      z-index: 20;
      color: white;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    #squirrelDeathScreen.show {
      display: flex;
      opacity: 1;
    }
    #squirrelMobileControls {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 60px;
      display: none;
      justify-content: space-between;
      padding: 10px;
      box-sizing: border-box;
      z-index: 5;
    }
    .squirrel-mobile-btn {
      width: 80px;
      height: 40px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      color: white;
      -webkit-tap-highlight-color: transparent;
    }

    /* Rules text on the right side of the game, center-aligned */
    .game-rules {
      max-width: 100%;
      width: 500px;
      line-height: 1.6;
      font-family: 'Montserrat', sans-serif;
      font-size: 16px;
      color: #000;
      background: none;
      border: none;
      padding: 0 20px;
    }
    
    /* Footer styling */
    footer {
      width: 100%;
      text-align: center;
      font-size: 12px;
      color: #333;
      padding: 15px 0;
      margin-top: 20px;
    }

    /* Mobile-specific styles */
    @media (max-width: 768px) {
      body {
        font-size: 16px;
      }
      
      .popup {
        background-size: 80%; /* Keep mobile size the same */
      }
      
      .popup h1 {
        font-size: 2rem;
      }
      
      .popup p {
        font-size: 1rem;
      }
      
      .popup .buttons button {
        font-size: 1rem;
        padding: 8px 16px;
      }
      
      .info-content img {
        float: none;
        display: block;
        margin: 0 auto 20px;
        width: 100%;
        max-width: 300px;
      }
      
      .info-content p {
        font-size: 1rem;
      }
      
      #earthDefenderHealthText {
        right: 10px;
        top: 35px;
      }
      
      #earthDefenderAmmoDisplay {
        font-size: 8px;
      }
      
      #earthDefenderHealthBar {
        width: 100px;
      }
      
      /* Adjusted game scaling */
      #gameContainer2, #squirrelGameContainer {
        transform: scale(1.05);
        transform-origin: top center;
        margin: 15px 0;
      }
      
      .games-container {
        gap: 10px;
      }
      
      .navbar {
        height: 45px;
      }
      
      .navbar h1 {
        font-size: 1rem;
      }
      
      .navbar h1::before {
        width: 25px;
        height: 25px;
      }
    }

    @media (max-width: 480px) {
      .popup {
        background-size: 90%; /* Keep mobile size the same */
      }
      
      .popup h1 {
        font-size: 1.8rem;
      }
      
      .popup .buttons {
        flex-direction: column;
        gap: 10px;
      }
      
      .popup .buttons button {
        width: 100%;
      }
      
      .section {
        padding: 4rem 1rem 2rem;
      }
      
      #earthDefenderRulesPopup h2 {
        font-size: 1.2rem;
      }
      
      #earthDefenderRulesPopup p {
        font-size: 0.9rem;
      }
      
      /* Adjusted game scaling */
      #gameContainer2, #squirrelGameContainer {
        transform: scale(1.1);
        height: 350px;
      }
      
      /* Compact navbar adjustments */
      .navbar {
        height: 40px;
      }
      
      .navbar .buttons button {
        font-size: 0.9rem;
        padding: 4px 8px;
      }
      
      .navbar h1 {
        font-size: 0.9rem;
      }
      
      .arrow-up {
        top: 0;
      }
      
      .navbar h1::before {
        width: 20px;
        height: 20px;
        margin-right: 5px;
      }
    }
  </style>
</head>
<body>
  <!-- Full-screen pop-up -->
  <div id="popup" class="popup">
    <div class="popup-content">
      <h1>Earth Day</h1>
      <p>made by SIS South Jakarta</p>
      <div class="buttons">
        <button id="infoBtn">Information</button>
        <button id="gamesBtn">Games</button>
      </div>
      <div id="closePopup" class="arrow-down">&#9660;</div>
    </div>
  </div>

  <!-- Fullscreen Game Popup -->
  <div id="fullscreenGame" class="fullscreen-game">
    <div class="fullscreen-game-content" id="fullscreenGameContent"></div>
    <div class="close-fullscreen" id="closeFullscreen">×</div>
  </div>

  <!-- Minimized top navigation bar -->
  <nav id="navbar" class="navbar">
    <div id="openPopup" class="arrow-up">&#9650;</div>
    <div class="buttons">
      <button id="infoNavBtn">Information</button>
      <button id="gamesNavBtn">Games</button>
    </div>
    <h1>Earth Day</h1>
  </nav>

  <!-- Information Section -->
  <section id="information" class="section">
    <h2>Information</h2>
    <div class="info-content">
      <img 
        src="https://sissjearthday.tiiny.site/earth_day_cleaner.png" 
        alt="Earth Day Cleaner"
      >
      <div>
        <p>
          Earth Day is celebrated on the 22nd of April every year around the globe to propagate awareness about environmental degradation and make it easier for activities to rescue our planet. Earth Day was initially celebrated in 1970 and gave rise to the current-day environmental movement. United States Senator Gaylord Nelson initiated Earth Day with a focus on bringing environmental pollution and degradation to the forefront.
        </p>
        <p>
          Earth Day is today a global movement, with more than 1 billion people getting involved every year by planting trees, picking up trash, encouraging recycling, reducing plastic consumption, and pushing for climate policy.
        </p>
        <p>
          There is a theme for every Earth Day—past themes have been climate action, bringing back ecosystems, and investing in our future. The themes are utilized to assist communities, schools, governments, and organizations in planning events and generating awareness.
        </p>
        <p>
          Earth Day is a reminder that environmental conservation is everyone's responsibility. Little things count, from switching off lights when not in use, using reusable bags, saving water, or putting money into renewable energy. It's a time to reflect on how our daily decisions affect the world—and how we can make more environmentally friendly ones.
        </p>
      </div>
    </div>
  </section>

  <!-- Games Section -->
  <section id="games" class="section">
    <h2>Games</h2>
    <div class="games-container">
      <!-- Earth Defender Game (Left side) -->
      <div class="game-wrapper">
        <h3>Earth Defender</h3>
        <div id="gameContainer2" class="game-container">
          <!-- Earth Defender Game Elements -->
          <div id="earthDefenderRulesPopup">
            <h2>EARTH DEFENDER</h2>
            <p><strong>How to Play:</strong></p>
            <p>1. Protect Earth from <span style="color:#e74c3c">red harmful words</span></p>
            <p>2. Collect <span style="color:#2ecc71">green helpful words</span> to heal</p>
            <p>3. Move mouse to aim | <strong>Click</strong> to shoot (uses 1 bullet)</p>
            <p>4. Start with 15 bullets (max 21). Get +5 from green words</p>
            <button id="earthDefenderStartBtn">START</button>
          </div>
          <div id="earthDefenderAmmoDisplay" style="display:none">
            Bullets: <span id="earthDefenderAmmoValue">15</span>/21
          </div>
          <div id="earthDefenderHealthText" style="display:none">
            Earth Health: <span id="earthDefenderHealthValue">100</span>
          </div>
          <div id="earthDefenderHealthBar" style="display:none">
            <div id="earthDefenderHealthFill"></div>
          </div>
          <div id="earthDefenderGameOver">
            GAME OVER<br>
            <button id="earthDefenderRestartBtn">Restart</button>
          </div>
          <canvas id="earthDefenderCanvas"></canvas>
        </div>
        <button class="fullscreen-btn" data-game="2">Full Screen</button>
      </div>
      <!-- Game Rules Panel (Right side, plain text) -->
      <div class="game-rules">
        This retro-inspired game challenges you to defend the planet from harmful influences. By shooting incoming threats and collecting helpful words, you actively contribute to preserving Earth's vitality. The gameplay reflects Earth Day's message by emphasizing the importance of environmental stewardship. Every shot and every saved word reminds you that even small efforts matter in protecting our world.
      </div>
      
      <!-- Squirrel Climber Game -->
      <div class="game-wrapper">
        <h3>Squirrel Climber</h3>
        <div id="squirrelGameContainer">
          <div id="squirrelGameInstructions">
            <h2>Squirrel Climber</h2>
            <p>Use left/right arrows or touch controls to move.</p>
            <p>Avoid the carbon emissions and don't fall.</p>
            <p>Climb the tree into space!</p>
            <button id="startSquirrelGameBtn">Start Game</button>
          </div>
          <div id="squirrelDeathScreen">
            <h2>Game Over!</h2>
            <p id="squirrelFinalScore">You climbed to height: 0</p>
            <p>Better luck next time!</p>
            <button id="restartSquirrelGameBtn">Play Again</button>
          </div>
          <div id="squirrelMobileControls">
            <div class="squirrel-mobile-btn" id="squirrelLeftBtn">←</div>
            <div class="squirrel-mobile-btn" id="squirrelRightBtn">→</div>
          </div>
        </div>
        <button class="fullscreen-btn" data-game="squirrel">Full Screen</button>
      </div>
      <!-- Game Rules Panel for Squirrel Climber -->
      <div class="game-rules">
        A game about a squirrel climbing a tree to space to escape rising carbon emissions cleverly ties into Earth Day by using playful storytelling to highlight the serious issue of climate change. As the squirrel ascends to avoid the toxic effects of pollution, players are reminded of the urgent need to protect our environment and reduce carbon emissions.
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    All the code developed by Mehdi Rahimli Secondary 3, and all the text by Seonghyun Je Secondary 3
  </footer>

  <script>
    // Global variables for fullscreen state and placeholders
    let currentFullscreenGame = null;
    const originalParents = {};
    const originalPlaceholders = {};

    // Smooth scrolling function
    function scrollToSection(sectionId) {
      const section = document.getElementById(sectionId);
      section.scrollIntoView({ behavior: 'smooth' });
    }

    // Popup and Navbar functionality
    const popup = document.getElementById('popup');
    const navbar = document.getElementById('navbar');
    const closePopupBtn = document.getElementById('closePopup');
    const openPopupBtn = document.getElementById('openPopup');
    const infoBtn = document.getElementById('infoBtn');
    const gamesBtn = document.getElementById('gamesBtn');
    const infoNavBtn = document.getElementById('infoNavBtn');
    const gamesNavBtn = document.getElementById('gamesNavBtn');

    closePopupBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
    });
    openPopupBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(0)';
      navbar.style.top = '-100px';
    });
    infoBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
      scrollToSection('information');
    });
    infoNavBtn.addEventListener('click', () => { scrollToSection('information'); });
    gamesBtn.addEventListener('click', () => {
      popup.style.transform = 'translateY(-100%)';
      navbar.style.top = '0';
      scrollToSection('games');
    });
    gamesNavBtn.addEventListener('click', () => { scrollToSection('games'); });

    // Fullscreen button functionality
    const fullscreenButtons = document.querySelectorAll('.fullscreen-btn');
    fullscreenButtons.forEach(button => {
      button.addEventListener('click', function() {
        const gameNumber = this.getAttribute('data-game');
        let gameContainer;
        
        if (gameNumber === '2') {
          gameContainer = document.getElementById('gameContainer2');
        } else if (gameNumber === 'squirrel') {
          gameContainer = document.getElementById('squirrelGameContainer');
        }
        
        // Store original parent and insert placeholder if not done.
        if (!originalParents[gameNumber]) {
          originalParents[gameNumber] = gameContainer.parentElement;
          const placeholder = document.createElement('div');
          placeholder.style.display = 'none';
          originalParents[gameNumber].insertBefore(placeholder, gameContainer);
          originalPlaceholders[gameNumber] = placeholder;
        }
        
        // Save original inline styles.
        gameContainer.dataset.originalWidth = gameContainer.style.width;
        gameContainer.dataset.originalHeight = gameContainer.style.height;
        
        // Set container to maintain aspect ratio
        if (gameNumber === 'squirrel') {
          // For squirrel game (300x450 = 2:3 ratio)
          gameContainer.style.width = '80vmin';
          gameContainer.style.height = '120vmin';
        } else {
          // For earth defender (500x400 = 5:4 ratio)
          gameContainer.style.width = '100vmin';
          gameContainer.style.height = '80vmin';
        }
        
        gameContainer.style.display = 'block';
        gameContainer.style.margin = 'auto';
        
        // Move the container to the fullscreen overlay.
        const fullscreenGame = document.getElementById('fullscreenGame');
        const fullscreenGameContent = document.getElementById('fullscreenGameContent');
        fullscreenGameContent.innerHTML = '';
        fullscreenGameContent.appendChild(gameContainer);
        fullscreenGame.style.display = 'flex';
        currentFullscreenGame = gameNumber;
      });
    });

    // Close fullscreen – return container to its original location.
    const closeFullscreen = document.getElementById('closeFullscreen');
    closeFullscreen.addEventListener('click', () => {
      if (currentFullscreenGame) {
        let gameContainer;
        if (currentFullscreenGame === '2') {
          gameContainer = document.getElementById('gameContainer2');
        } else if (currentFullscreenGame === 'squirrel') {
          gameContainer = document.getElementById('squirrelGameContainer');
        }
        
        // Restore original dimensions.
        gameContainer.style.width = gameContainer.dataset.originalWidth || '';
        gameContainer.style.height = gameContainer.dataset.originalHeight || '';
        gameContainer.style.margin = '';
        
        if (originalPlaceholders[currentFullscreenGame]) {
          originalPlaceholders[currentFullscreenGame].parentNode.insertBefore(gameContainer, originalPlaceholders[currentFullscreenGame]);
          originalPlaceholders[currentFullscreenGame].remove();
          delete originalPlaceholders[currentFullscreenGame];
        } else {
          originalParents[currentFullscreenGame].appendChild(gameContainer);
        }
        
        const fullscreenGame = document.getElementById('fullscreenGame');
        fullscreenGame.style.display = 'none';
        currentFullscreenGame = null;
      }
    });

    // =============================================
    // EARTH DEFENDER GAME CODE
    // =============================================
    document.addEventListener('DOMContentLoaded', function() {
      const canvas = document.getElementById('earthDefenderCanvas');
      const ctx = canvas.getContext('2d');
      // Disable image smoothing for a crisp pixelated look
      ctx.imageSmoothingEnabled = false;
      
      // Set initial canvas size based on container
      const container = document.getElementById('gameContainer2');
      canvas.width = container.offsetWidth;
      canvas.height = container.offsetHeight;
      
      let earthDefenderGameStarted = false;
      let earthHealth = 100;
      let earthDefenderGameRunning = true;
      let ammo = 15;
      const maxAmmo = 21;
      const harmfulWords = [
        "Plastic pollution", "Deforestation", "Air pollution", "Overfishing", "Fast fashion",
        "Fossil fuels", "Pesticide use", "Food waste", "Single-use plastics", "Water pollution",
        "Ocean acidification", "Excessive meat consumption", "Habitat destruction", "Chemical runoff",
        "Urban sprawl", "Excessive energy use", "Wildlife trafficking", "Landfills", "Mining operations",
        "Climate change denial"
      ];
      const helpfulWords = [
        "Planting trees", "Recycling", "Renewable energy", "Sustainable agriculture", "Protecting wildlife"
      ];
      let activeWords = [];
      let projectiles = [];
      let mouseX = 0;
      let mouseY = 0;
      let stars = [];

      // Check if mobile device
      const isMobile = /Mobi|Android/i.test(navigator.userAgent);

      // Load the Earth image
      const earthImg = new Image();
      earthImg.src = "https://sissjearthday.tiiny.site/earth_day_earth.png";
      // Load the arrow image
      const arrowImg = new Image();
      arrowImg.src = "https://sissjearthday.tiiny.site/earth_day_pointer.png";
      // Load the bullet image
      const bulletImg = new Image();
      bulletImg.src = "https://sissjearthday.tiiny.site/earth_day_bullet.png";

      function createStars() {
        stars = [];
        const starCount = 150;
        for (let i = 0; i < starCount; i++) {
          stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 1.5,
            opacity: Math.random()
          });
        }
      }

      // Increased space around earth by scaling down elements
      const earth = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        radius: Math.min(canvas.width, canvas.height) * 0.07, // Reduced from 0.1 to create more space
        angle: 0
      };

      const arrow = {
        x: 0,
        y: 0,
        angle: 0,
        size: Math.min(canvas.width, canvas.height) * 0.03, // Reduced size
        rotation: 0,
        orbitDistance: Math.min(canvas.width, canvas.height) * 0.12 // Reduced distance
      };

      function startGame() {
        earthDefenderGameStarted = true;
        document.getElementById('earthDefenderRulesPopup').style.display = 'none';
        document.getElementById('earthDefenderAmmoDisplay').style.display = 'block';
        document.getElementById('earthDefenderHealthText').style.display = 'block';
        document.getElementById('earthDefenderHealthBar').style.display = 'block';
        createStars();
        updateHealth();
        updateAmmo();
        earthDefenderGameLoop();
      }

      function updateArrow() {
        const angleToMouse = Math.atan2(mouseY - earth.y, mouseX - earth.x);
        arrow.x = earth.x + Math.cos(angleToMouse) * arrow.orbitDistance;
        arrow.y = earth.y + Math.sin(angleToMouse) * arrow.orbitDistance;
        arrow.rotation = angleToMouse;
      }

      function spawnWord() {
        if (activeWords.length >= (isMobile ? 3 : 5)) return; // Different limits for mobile/desktop
        if (Math.random() > (isMobile ? 0.1 : 0.07)) return; // Different spawn rates
        const isHelpful = Math.random() < 0.2;  // 20% chance green
        const wordList = isHelpful ? helpfulWords : harmfulWords;
        const word = wordList[Math.floor(Math.random() * wordList.length)];
        const angle = Math.random() * Math.PI * 2;
        const distance = (Math.max(canvas.width, canvas.height) / 2) * 1.5; // Increased spawn distance by 1.5x
        const x = earth.x + Math.cos(angle) * distance;
        const y = earth.y + Math.sin(angle) * distance;
        const baseSpeed = isMobile ? 0.3 : 0.7; // Different speeds for mobile/desktop
        const speedVariation = Math.random() * 0.3 - 0.15;
        const factor = (Math.random() < 0.3) ? (1.3 + Math.random() * 0.4) : 1;
        const speed = Math.max(0.15, baseSpeed + speedVariation) * factor;
        const isSpinning = (Math.random() < 0.5);
        const rotationSpeed = isSpinning ? (Math.random() * 0.08 - 0.04) : 0;
        const rotation = isSpinning ? 0 : Math.atan2(earth.y - y, earth.x - x);
        activeWords.push({
          text: word,
          x: x,
          y: y,
          targetX: earth.x,
          targetY: earth.y,
          speed: speed,
          color: isHelpful ? '#2ecc71' : '#e74c3c',
          isHelpful: isHelpful,
          rotation: rotation,
          rotationSpeed: rotationSpeed,
          fontSize: Math.min(canvas.width, canvas.height) * 0.025 // Smaller font
        });
      }

      function createProjectile() {
        if (ammo <= 0 || !earthDefenderGameStarted) return;
        ammo--;
        updateAmmo();
        const angleToMouse = Math.atan2(mouseY - earth.y, mouseX - earth.x);
        
        // Only shoot if clicking outside earth's radius (1.5x to match new space)
        const clickDistance = Math.sqrt(Math.pow(mouseX - earth.x, 2) + Math.pow(mouseY - earth.y, 2));
        if (clickDistance <= earth.radius * 1.5) return;
        
        // Calculate position at the arrow's tip (slightly in front of arrow)
        const tipDistance = arrow.size * 0.8;
        const tipX = arrow.x + Math.cos(angleToMouse) * tipDistance;
        const tipY = arrow.y + Math.sin(angleToMouse) * tipDistance;
        
        projectiles.push({
          x: tipX,
          y: tipY,
          speed: isMobile ? 7 : 9 * (canvas.width / 500), // Different speeds for mobile/desktop
          angle: angleToMouse,
          size: 8 * (canvas.width / 500) // Smaller bullets
        });
      }

      function updateAmmo() {
        document.getElementById('earthDefenderAmmoValue').textContent = ammo;
      }

      function checkWordCollision(word) {
        const dx = word.x - earth.x;
        const dy = word.y - earth.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        return distance < earth.radius + 10;
      }

      function update() {
        if (!earthDefenderGameRunning || !earthDefenderGameStarted) return;
        updateArrow();
        spawnWord();
        for (let i = activeWords.length - 1; i >= 0; i--) {
          const word = activeWords[i];
          if (Math.abs(word.rotationSpeed) > 0) {
            word.rotation += word.rotationSpeed;
          } else {
            word.rotation = Math.atan2(earth.y - word.y, earth.x - word.x);
          }
          const dx = word.targetX - word.x;
          const dy = word.targetY - word.y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          word.x += (dx / distance) * word.speed;
          word.y += (dy / distance) * word.speed;
          if (checkWordCollision(word)) {
            if (word.isHelpful) {
              earthHealth = Math.min(100, earthHealth + 15);
              ammo = Math.min(maxAmmo, ammo + 5);
            } else {
              earthHealth = Math.max(0, earthHealth - 13);
            }
            updateHealth();
            updateAmmo();
            activeWords.splice(i, 1);
          }
        }
        for (let i = projectiles.length - 1; i >= 0; i--) {
          const projectile = projectiles[i];
          projectile.x += Math.cos(projectile.angle) * projectile.speed;
          projectile.y += Math.sin(projectile.angle) * projectile.speed;
          if (projectile.x < 0 || projectile.x > canvas.width || 
              projectile.y < 0 || projectile.y > canvas.height) {
            projectiles.splice(i, 1);
            continue;
          }
          for (let j = activeWords.length - 1; j >= 0; j--) {
            const word = activeWords[j];
            const dx = projectile.x - word.x;
            const dy = projectile.y - word.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < 25 * (canvas.width / 500)) { // Smaller collision distance
              activeWords.splice(j, 1);
              projectiles.splice(i, 1);
              break;
            }
          }
        }
        if (earthHealth <= 0) {
          earthDefenderGameRunning = false;
          document.getElementById('earthDefenderGameOver').style.display = 'block';
        }
      }

      function updateHealth() {
        document.getElementById('earthDefenderHealthValue').textContent = earthHealth;
        document.getElementById('earthDefenderHealthFill').style.width = `${earthHealth}%`;
        if (earthHealth < 30) {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#e74c3c';
        } else if (earthHealth < 60) {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#f39c12';
        } else {
          document.getElementById('earthDefenderHealthFill').style.backgroundColor = '#2ecc71';
        }
      }

      function drawStars() {
        ctx.fillStyle = '#fff';
        for (const star of stars) {
          ctx.globalAlpha = star.opacity;
          ctx.beginPath();
          ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
      }

      function draw() {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        if (earthDefenderGameStarted) drawStars();
        if (earthDefenderGameStarted) {
          // Draw the Earth using the image, keeping the same scale.
          ctx.drawImage(earthImg, earth.x - earth.radius, earth.y - earth.radius, earth.radius * 2, earth.radius * 2);
          
          // Draw the arrow (pointer) using the arrow image, flipped by 90°.
          ctx.save();
          ctx.translate(arrow.x, arrow.y);
          ctx.rotate(arrow.rotation + Math.PI/2);
          ctx.drawImage(arrowImg, -arrow.size / 2, -arrow.size / 2, arrow.size, arrow.size);
          ctx.restore();
          
          // Draw each projectile (bullet) using the bullet image.
          for (const projectile of projectiles) {
            ctx.drawImage(bulletImg, projectile.x - projectile.size, projectile.y - projectile.size, projectile.size * 2, projectile.size * 2);
          }
          
          // Use a smaller pixelated font for in-canvas text.
          const baseFontSize = Math.min(canvas.width, canvas.height) * 0.025;
          ctx.font = `${baseFontSize}px "Press Start 2P", monospace`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          for (const word of activeWords) {
            ctx.save();
            ctx.translate(word.x, word.y);
            ctx.rotate(word.rotation);
            ctx.fillStyle = word.color;
            ctx.font = `${word.fontSize}px "Press Start 2P", monospace`;
            ctx.fillText(word.text, 0, 0);
            ctx.restore();
          }
        }
      }

      function earthDefenderGameLoop() {
        update();
        draw();
        requestAnimationFrame(earthDefenderGameLoop);
      }

      // Handle window resize
      function handleResize() {
        const container = document.getElementById('gameContainer2');
        canvas.width = container.offsetWidth;
        canvas.height = container.offsetHeight;
        
        // Update game elements sizes
        earth.radius = Math.min(canvas.width, canvas.height) * 0.07;
        earth.x = canvas.width / 2;
        earth.y = canvas.height / 2;
        
        arrow.size = Math.min(canvas.width, canvas.height) * 0.03;
        arrow.orbitDistance = Math.min(canvas.width, canvas.height) * 0.12;
      }

      window.addEventListener('resize', handleResize);

      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;
      });

      canvas.addEventListener('click', () => {
        if (earthDefenderGameRunning) createProjectile();
      });

      document.getElementById('earthDefenderStartBtn').addEventListener('click', startGame);
      document.getElementById('earthDefenderRestartBtn').addEventListener('click', () => {
        earthHealth = 100;
        ammo = 15;
        activeWords = [];
        projectiles = [];
        earthDefenderGameRunning = true;
        updateHealth();
        updateAmmo();
        document.getElementById('earthDefenderGameOver').style.display = 'none';
      });
      updateHealth();
      updateAmmo();
      
      // Initialize game with proper sizing
      handleResize();
    });

    // =============================================
    // SQUIRREL CLIMBER GAME CODE (EXACTLY AS PROVIDED)
    // =============================================
    document.addEventListener('DOMContentLoaded', function() {
      // Only initialize if the game container exists
      const squirrelContainer = document.getElementById('squirrelGameContainer');
      if (!squirrelContainer) return;

      const sketch = function(p) {
        let doodler;
        let platforms = [];
        let gap;
        let score = 0;
        let gameState = "start"; // "start", "playing", "gameover"
        let carbonEmissions = [];
        let treeImg, platformImg, squirrelImg, carbonImg, cloudImg, starsImg, co2Gif, groundImg;
        const worldFloorY = 550; // Extended floor
        let treeOffset = 0;
        const treeWidth = 250; // Wider tree (was 200)
        const platformGapMultiplier = 1.5; // Increased platform spacing
        let clouds = [];
        let starsActive = false;
        let starSections = [];
        const starSectionHeight = 150; // Height of each star section
        let blowingAway = false;
        let isMobile = false;
        let leftPressed = false;
        let rightPressed = false;
        let frameCount = 0;

        p.preload = function() {
          treeImg = p.loadImage("https://sissjearthday.tiiny.site/tree_trunk.png");
          groundImg = p.loadImage("https://sissjearthday.tiiny.site/ground.png");
          platformImg = p.loadImage("https://sissjearthday.tiiny.site/platform.png");
          squirrelImg = p.loadImage("https://sissjearthday.tiiny.site/squirrel.png");
          cloudImg = p.loadImage("https://sissjearthday.tiiny.site/cloud.png");
          starsImg = p.loadImage("https://sissjearthday.tiiny.site/stars.png");
          carbonImg = p.loadImage("https://sissjearthday.tiiny.site/co2.png");
          co2Gif = p.loadImage("https://sissjearthday.tiiny.site/co2-gif.gif");
        };

        p.setup = function() {
          const gameCanvas = p.createCanvas(300, 450);
          gameCanvas.parent('squirrelGameContainer');
          doodler = new Doodler();

          // Check if mobile device
          isMobile = /Mobi|Android/i.test(navigator.userAgent);
          if (isMobile) {
            document.getElementById('squirrelMobileControls').style.display = 'flex';
          }

          // Create initial platforms with increased spacing
          let platformCount = 6;
          gap = (p.height / 4) * platformGapMultiplier; // Larger gap between platforms
          for (let i = 0; i < platformCount; i++) {
            platforms.push(new Platform(p.randomPlatformX(), worldFloorY - i * gap));
          }

          // Set up restart button
          document.getElementById('restartSquirrelGameBtn').addEventListener('click', resetGame);
          
          // Mobile controls
          document.getElementById('squirrelLeftBtn').addEventListener('touchstart', function(e) {
            e.preventDefault();
            leftPressed = true;
          });
          document.getElementById('squirrelLeftBtn').addEventListener('touchend', function(e) {
            e.preventDefault();
            leftPressed = false;
          });
          document.getElementById('squirrelLeftBtn').addEventListener('touchcancel', function(e) {
            e.preventDefault();
            leftPressed = false;
          });
          
          document.getElementById('squirrelRightBtn').addEventListener('touchstart', function(e) {
            e.preventDefault();
            rightPressed = true;
          });
          document.getElementById('squirrelRightBtn').addEventListener('touchend', function(e) {
            e.preventDefault();
            rightPressed = false;
          });
          document.getElementById('squirrelRightBtn').addEventListener('touchcancel', function(e) {
            e.preventDefault();
            rightPressed = false;
          });
        };

        p.draw = function() {
          frameCount++;
          
          // Compute sky darkness with a slower transition (from score 0 to 100)
          let darkness = p.constrain(p.map(score, 0, 100, 0, 1), 0, 1);
          let skyR = p.lerp(173, 0, darkness);
          let skyG = p.lerp(216, 0, darkness);
          let skyB = p.lerp(230, 64, darkness);
          p.background(skyR, skyG, skyB);

          if (gameState === "start") {
            startScreen();
          } else if (gameState === "playing") {
            playGame(darkness);
          } else if (gameState === "gameover") {
            // Handled by the death screen div
          }
        };

        // Draw the scrolling tree trunk
        function drawTree() {
          // Calculate how much to offset the tree texture based on doodler's position
          treeOffset = doodler.y % treeImg.height;
          
          // Draw the tree texture repeatedly to cover the visible area
          let visibleTop = doodler.y - p.height / 2;
          let visibleBottom = doodler.y + p.height / 2;
          
          // Start drawing tree segments above the visible area
          let startY = visibleTop - treeOffset - treeImg.height;
          let endY = visibleBottom;
          
          // Draw the tree segments
          for (let y = startY; y < endY; y += treeImg.height) {
            p.image(treeImg, p.width/2 - treeWidth/2, y, treeWidth, treeImg.height);
          }
        }

        function updateClouds() {
          // Remove clouds that are off screen
          for (let i = clouds.length - 1; i >= 0; i--) {
            if (clouds[i].y > doodler.y + p.height/2 + 100) {
              clouds.splice(i, 1);
            }
          }
          
          // Add new clouds randomly anywhere on screen (3x larger with random sizes)
          if (p.random() < 0.02 && clouds.length < 5) {
            clouds.push({
              x: p.random(p.width),
              y: doodler.y - p.height/2 - p.random(20, 120),
              size: p.random(2, 4) // Random size between 2x and 4x original
            });
          }
        }

        function drawClouds() {
          for (let cloud of clouds) {
            p.push();
            p.translate(cloud.x, cloud.y);
            p.scale(cloud.size);
            p.image(cloudImg, -cloudImg.width/2, -cloudImg.height/2);
            p.pop();
          }
        }

        function updateStars(darkness) {
          starsActive = darkness >= 1;
          if (!starsActive) {
            starSections = [];
            return;
          }

          // Remove star sections that are off screen
          for (let i = starSections.length - 1; i >= 0; i--) {
            if (starSections[i].y > doodler.y + p.height/2 + starSectionHeight || 
                starSections[i].y < doodler.y - p.height/2 - starSectionHeight) {
              starSections.splice(i, 1);
            }
          }
          
          // Add new star section above if needed
          if (starSections.length === 0 || 
              starSections[starSections.length-1].y > doodler.y - p.height/2 - starSectionHeight) {
            let newY = starSections.length === 0 ? doodler.y - p.height/2 - starSectionHeight : 
                      starSections[starSections.length-1].y - starSectionHeight;
            starSections.push({
              y: newY,
              sectionY: p.floor(p.random(starsImg.height - starSectionHeight))
            });
          }
          
          // Add new star section below if needed
          if (starSections.length === 0 || 
              starSections[0].y < doodler.y + p.height/2) {
            let newY = starSections.length === 0 ? doodler.y + p.height/2 : 
                      starSections[0].y + starSectionHeight;
            starSections.unshift({
              y: newY,
              sectionY: p.floor(p.random(starsImg.height - starSectionHeight))
            });
          }
        }

        function drawStars() {
          if (!starsActive) return;
          
          for (let star of starSections) {
            // Draw a random section of the stars image
            p.image(starsImg, 
                  0, star.y, 
                  p.width, starSectionHeight,
                  0, star.sectionY,
                  starsImg.width, starSectionHeight);
          }
        }

        function spawnCarbonEmission() {
          if (frameCount % 120 === 0 && p.random() < 0.3) {
            carbonEmissions.push({
              x: p.width / 2 - treeWidth/2 + p.random(treeWidth),
              y: doodler.y - p.height / 2 - 100,
              width: 80,
              height: 80,
              speed: p.random(1, 3),
              direction: p.random() < 0.5 ? -1 : 1,
              hit: false
            });
          }
        }

        function updateCarbonEmissions() {
          for (let i = carbonEmissions.length - 1; i >= 0; i--) {
            let emission = carbonEmissions[i];
            
            if (!emission.hit) {
              // Move left/right
              emission.x += emission.speed * emission.direction;
              
              // Change direction at edges
              if (emission.x < p.width/2 - treeWidth/2 || emission.x > p.width/2 + treeWidth/2 - emission.width) {
                emission.direction *= -1;
              }
              
              // Check collision with doodler
              if (doodlerHitsEmission(emission)) {
                emission.hit = true;
                doodler.velocity = -20; // Blow the character upwards
                doodler.gravity = 0.05; // Reduce gravity to make it float away
                blowingAway = true;
                carbonEmissions.splice(i, 1); // Remove the emission immediately
              }
            }
          }
          
          // If blowing away, check if character is off screen
          if (blowingAway && doodler.y + doodler.height < -50) {
            gameOver();
          }
        }

        function drawCarbonEmissions() {
          for (let emission of carbonEmissions) {
            p.push();
            p.translate(emission.x + emission.width/2, emission.y + emission.height/2);
            if (emission.direction > 0) { // Flip the condition to flip the image
              p.scale(-1, 1); // Flip horizontally if moving right
            }
            p.image(carbonImg, -emission.width/2, -emission.height/2, emission.width, emission.height);
            p.pop();
          }
        }

        // Main game-playing function
        function playGame(darkness) {
          // Update stars first
          updateStars(darkness);
          
          // Draw stars (behind everything)
          p.push();
          p.translate(0, p.height / 2 - doodler.y);
          drawStars();
          
          // Draw clouds (mid-ground)
          updateClouds();
          drawClouds();
          p.pop();

          // Draw the scrolling tree
          p.push();
          p.translate(0, p.height / 2 - doodler.y);
          drawTree();
          p.pop();

          // Switch to world coordinates
          p.push();
          p.translate(0, p.height / 2 - doodler.y);

          // Draw ground image
          p.image(groundImg, 0, worldFloorY, p.width, groundImg.height * (p.width/groundImg.width));

          // Spawn and update carbon emissions
          spawnCarbonEmission();
          updateCarbonEmissions();
          drawCarbonEmissions();

          // Draw and update doodler and platforms
          doodler.draw();
          if (!blowingAway) {
            doodler.update(platforms);
          } else {
            // When blowing away, just apply gravity
            doodler.y += doodler.velocity;
            doodler.velocity += doodler.gravity;
          }
          
          for (let platform of platforms) {
            platform.draw();
          }
          
          // Add new platforms as player climbs (with increased spacing)
          if (platforms.length > 0 && doodler.y < platforms[platforms.length - 1].y + gap) {
            platforms.push(new Platform(p.randomPlatformX(), platforms[platforms.length - 1].y - gap));
          }
          
          // Remove platforms that are far below
          if (platforms.length > 0 && platforms[0].y > doodler.y + p.height) {
            platforms.splice(0, 1);
            score++;
          }

          p.pop();

          // Draw score
          p.push();
          p.fill(255);
          p.textSize(20);
          p.textAlign(p.CENTER);
          p.text(score, p.width / 2, 30);
          p.pop();

          // Game over conditions
          if (doodler.y > worldFloorY + doodler.height) {
            gameOver();
          }
        }

        // Game over function
        function gameOver() {
          gameState = "gameover";
          document.getElementById('squirrelFinalScore').textContent = `You climbed to height: ${score}`;
          let deathScreen = document.getElementById('squirrelDeathScreen');
          deathScreen.classList.add('show');
        }

        function doodlerHitsEmission(emission) {
          return (
            doodler.x + doodler.width > emission.x &&
            doodler.x < emission.x + emission.width &&
            doodler.y + doodler.height > emission.y &&
            doodler.y < emission.y + emission.height
          );
        }

        function startScreen() {
          // Handled by HTML instructions popup
        }

        p.keyPressed = function() {
          if (gameState === "start" && p.key === ' ') {
            document.getElementById('squirrelGameInstructions').style.display = 'none';
            gameState = "playing";
          } else if (gameState === "gameover" && p.key === ' ') {
            resetGame();
          }
        };

        function resetGame() {
          doodler = new Doodler();
          platforms = [];
          score = 0;
          carbonEmissions = [];
          treeOffset = 0;
          clouds = [];
          starsActive = false;
          starSections = [];
          blowingAway = false;
          
          let platformCount = 6;
          gap = (p.height / 4) * platformGapMultiplier; // Use the increased gap
          for (let i = 0; i < platformCount; i++) {
            platforms.push(new Platform(p.randomPlatformX(), worldFloorY - i * gap));
          }
          gameState = "playing";
          document.getElementById('squirrelDeathScreen').classList.remove('show');
          document.getElementById('squirrelGameInstructions').style.display = 'none';
        }

        p.randomPlatformX = function() {
          let minX = p.width / 2 - treeWidth/2;
          let maxX = p.width / 2 + treeWidth/2 - platformImg.width;
          return p.random(minX, maxX);
        };

        // Doodler Class
        class Doodler {
          constructor() {
            this.x = p.width / 2;
            this.y = worldFloorY - 200;
            this.width = 40;
            this.height = 40;
            this.velocity = 0;
            this.gravity = 0.1;
            this.jumpForce = 8;
            this.facingRight = true;
            this.maxVelocity = 10; // Decreased from 10 to 9
          }
          draw() {
            p.push();
            // Flip image based on movement direction
            if (this.facingRight) {
              p.image(squirrelImg, this.x, this.y, this.width, this.height);
            } else {
              p.translate(this.x + this.width, 0);
              p.scale(-1, 1);
              p.image(squirrelImg, 0, this.y, this.width, this.height);
            }
            p.pop();
          }
          update(platforms) {
            // Wrap around screen edges
            if (this.x + this.width < 0) this.x = p.width;
            if (this.x > p.width) this.x = -this.width;
            
            // Update facing direction based on keyboard or touch
            if (p.keyIsDown(p.LEFT_ARROW) || leftPressed) this.facingRight = false;
            if (p.keyIsDown(p.RIGHT_ARROW) || rightPressed) this.facingRight = true;
            
            this.velocity += this.gravity;
            
            // Apply velocity cap (now 9 instead of 10)
            if (this.velocity > this.maxVelocity) {
              this.velocity = this.maxVelocity;
            } else if (this.velocity < -this.maxVelocity) {
              this.velocity = -this.maxVelocity;
            }
            
            this.y += this.velocity;
            
            // Horizontal movement (keyboard or touch)
            if (p.keyIsDown(p.LEFT_ARROW) || leftPressed) {
              this.x -= 6;
            }
            if (p.keyIsDown(p.RIGHT_ARROW) || rightPressed) {
              this.x += 6;
            }
            
            // Platform collision (including ground when score is 0)
            for (let platform of platforms) {
              if (
                this.y + this.height >= platform.y &&
                this.y + this.height <= platform.y + platform.height
              ) {
                let minX = platform.x - this.width;
                let maxX = platform.x + platform.width;
                if (this.x >= minX && this.x <= maxX) {
                  this.velocity = this.velocity > 0 ? -this.jumpForce * 0.8 : -this.jumpForce;
                }
              }
            }
            
            // Ground collision (only when score is 0)
            if (score === 0 && this.y + this.height >= worldFloorY && this.velocity > 0) {
              this.velocity = -this.jumpForce;
            }
            
            if (this.velocity < -this.jumpForce) this.velocity = -this.jumpForce;
          }
        }

        // Platform Class
        class Platform {
          constructor(x, y) {
            this.x = x;
            this.y = y;
            this.width = 60;
            this.height = 15;
          }
          draw() {
            p.image(platformImg, this.x, this.y, this.width, this.height);
          }
        }

        // Event listeners
        document.getElementById('startSquirrelGameBtn').addEventListener('click', function() {
          document.getElementById('squirrelGameInstructions').style.display = 'none';
          gameState = "playing";
        });
      };

      new p5(sketch);
    });
  </script>
</body>
</html>
